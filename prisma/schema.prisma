generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Attendance {
  id        String   @id
  date      DateTime @default(now())
  present   Boolean  @default(false)
  playerId  String
  createdAt DateTime @default(now())
  updatedAt DateTime
  Player    Player   @relation(fields: [playerId], references: [id])

  @@unique([playerId, date])
}

model AuditLog {
  id        String   @id
  action    String
  entity    String
  entityId  String
  details   String?
  timestamp DateTime @default(now())
  userId    String?
  User      User?    @relation(fields: [userId], references: [id])
}

model CategoryMapping {
  id        String   @id
  category  String   @unique
  minYear   Int
  maxYear   Int
  updatedAt DateTime
}

model Coach {
  id               String          @id
  name             String
  phone            String?
  email            String?
  dni              String?         @unique
  birthDate        DateTime?
  observations     String?
  tira             String?
  category         String?
  role             String?
  status           String          @default("ACTIVO")
  salary           Float           @default(0)
  registrationDate DateTime?
  withdrawalDate   DateTime?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  SalaryHistory    SalaryHistory[]
}

model DismissedAuditIssue {
  id         String   @id
  ruleId     String
  identifier String
  reason     String?
  createdAt  DateTime @default(now())

  @@unique([ruleId, identifier])
}

model ImportDetail {
  id               String        @id
  summaryId        String
  playerName       String
  action           String
  details          String?
  entityId         String?
  conflictEntityId String?
  conflictData     String?
  resolved         Boolean       @default(false)
  createdAt        DateTime      @default(now())
  ImportSummary    ImportSummary @relation(fields: [summaryId], references: [id], onDelete: Cascade)
}

model ImportSummary {
  id              String         @id
  timestamp       DateTime       @default(now())
  fileName        String
  stats_created   Int
  stats_updated   Int
  stats_unchanged Int
  stats_errors    Int
  ImportDetail    ImportDetail[]
}

model Payment {
  id       String   @id
  amount   Float
  month    Int
  year     Int
  date     DateTime @default(now())
  playerId String
  Player   Player   @relation(fields: [playerId], references: [id])
}

model Player {
  id                  String       @id
  firstName           String
  lastName            String
  dni                 String       @unique
  birthDate           DateTime
  tira                String
  status              String       @default("ACTIVO")
  scholarship         Boolean      @default(false)
  federated           Boolean      @default(false)
  playsPrimera        Boolean      @default(false)
  email               String?
  phone               String?
  partnerNumber       String?
  shirtNumber         Int?
  contactName         String?
  observations        String?
  category            String?
  registrationDate    DateTime?
  withdrawalDate      DateTime?
  siblings            String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime
  lastSocialPayment      String?
  lastActivityPayment    String?
  federationYear         Int?     // Año del pago de seguro/federación (ej: 2026)
  federationInstallments String?  // "1", "2", "3" o "SALDADO"
  Attendance          Attendance[]
  Payment             Payment[]
}

model SalaryHistory {
  id      String   @id
  amount  Float
  date    DateTime @default(now())
  coachId String
  Coach   Coach    @relation(fields: [coachId], references: [id], onDelete: Cascade)
}

model User {
  id                  String     @id
  name                String?
  email               String     @unique
  password            String?
  role                String     @default("ADMIN")
  forcePasswordChange Boolean    @default(false)
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  AuditLog            AuditLog[]
}

model RolePermission {
  id         String   @id
  role       String
  permission String
  enabled    Boolean  @default(true)
  updatedAt  DateTime

  @@unique([role, permission])
}

model ActivityFee {
  id       String   @id @default(cuid())
  year     Int
  month    Int
  amount   Float
  category String   // "GLOBAL" or a specific category name
  @@unique([year, month, category])
}
