{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/auth.config.ts"],"sourcesContent":["import type { NextAuthConfig } from 'next-auth';\r\n\r\nexport const authConfig = {\r\n    pages: {\r\n        signIn: '/login',\r\n    },\r\n    callbacks: {\r\n        authorized({ auth, request: { nextUrl } }) {\r\n            const isLoggedIn = !!auth?.user;\r\n            const isOnDashboard = nextUrl.pathname.startsWith('/dashboard');\r\n            const isLoginPage = nextUrl.pathname === '/login';\r\n            const isRootPage = nextUrl.pathname === '/';\r\n\r\n            console.log('Middleware Authorized Check:', { pathname: nextUrl.pathname, isLoggedIn });\r\n\r\n            if (isOnDashboard) {\r\n                if (isLoggedIn) return true;\r\n                return false; // Redirect unauthenticated users to login page\r\n            } else if (isLoggedIn && (isLoginPage || isRootPage)) {\r\n                return Response.redirect(new URL('/dashboard', nextUrl));\r\n            }\r\n            return true;\r\n        },\r\n    },\r\n    providers: [], // Add providers with an empty array for now\r\n} satisfies NextAuthConfig;\r\n"],"names":[],"mappings":";;;;AAEO,MAAM,aAAa;IACtB,OAAO;QACH,QAAQ;IACZ;IACA,WAAW;QACP,YAAW,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,EAAE;YACrC,MAAM,aAAa,CAAC,CAAC,MAAM;YAC3B,MAAM,gBAAgB,QAAQ,QAAQ,CAAC,UAAU,CAAC;YAClD,MAAM,cAAc,QAAQ,QAAQ,KAAK;YACzC,MAAM,aAAa,QAAQ,QAAQ,KAAK;YAExC,QAAQ,GAAG,CAAC,gCAAgC;gBAAE,UAAU,QAAQ,QAAQ;gBAAE;YAAW;YAErF,IAAI,eAAe;gBACf,IAAI,YAAY,OAAO;gBACvB,OAAO,OAAO,+CAA+C;YACjE,OAAO,IAAI,cAAc,CAAC,eAAe,UAAU,GAAG;gBAClD,OAAO,SAAS,QAAQ,CAAC,IAAI,IAAI,cAAc;YACnD;YACA,OAAO;QACX;IACJ;IACA,WAAW,EAAE;AACjB"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n    globalForPrisma.prisma ||\r\n    new PrismaClient({\r\n        log: ['query'],\r\n    });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACT,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACb,KAAK;QAAC;KAAQ;AAClB;AAEJ,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/auth.ts"],"sourcesContent":["import NextAuth from 'next-auth';\r\nimport { authConfig } from './auth.config';\r\nimport Credentials from 'next-auth/providers/credentials';\r\nimport { z } from 'zod';\r\nimport { prisma } from '@/lib/prisma';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nimport Google from 'next-auth/providers/google';\r\n\r\nasync function getUser(email: string) {\r\n    try {\r\n        const user = await prisma.user.findUnique({ where: { email } });\r\n        return user;\r\n    } catch (error) {\r\n        console.error('Failed to fetch user:', error);\r\n        throw new Error('Failed to fetch user.');\r\n    }\r\n}\r\n\r\nexport const { auth, signIn, signOut, handlers } = NextAuth({\r\n    debug: true,\r\n    ...authConfig,\r\n    callbacks: {\r\n        async signIn({ user, account }) {\r\n            if (account?.provider === \"google\") {\r\n                const dbUser = await prisma.user.findUnique({\r\n                    where: { email: user.email as string }\r\n                });\r\n                return !!dbUser; // Only allow if exists in DB\r\n            }\r\n            return true;\r\n        },\r\n        async jwt({ token, user, trigger, session }) {\r\n            if (user) {\r\n                // Initial login\r\n                const dbUser = await prisma.user.findUnique({ where: { email: user.email as string } });\r\n                token.id = dbUser?.id || user.id;\r\n                token.role = dbUser?.role || 'VIEWER';\r\n            }\r\n            return token;\r\n        },\r\n        async session({ session, token }) {\r\n            if (session.user) {\r\n                session.user.id = token.id as string;\r\n                (session.user as any).role = token.role as string;\r\n            }\r\n            return session;\r\n        },\r\n    },\r\n    providers: [\r\n        Credentials({\r\n            async authorize(credentials) {\r\n                const parsedCredentials = z\r\n                    .object({ email: z.string().email(), password: z.string().min(6) })\r\n                    .safeParse(credentials);\r\n\r\n                if (parsedCredentials.success) {\r\n                    const { email, password } = parsedCredentials.data;\r\n                    const user = await getUser(email);\r\n                    if (!user) return null;\r\n                    if (!user.password) return null; // User might be OAuth only\r\n\r\n                    const passwordsMatch = await bcrypt.compare(password, user.password);\r\n                    if (passwordsMatch) return user;\r\n                }\r\n\r\n                console.log('Invalid credentials');\r\n                return null;\r\n            },\r\n        }),\r\n    ],\r\n});\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;AAIA,eAAe,QAAQ,KAAa;IAChC,IAAI;QACA,MAAM,OAAO,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC7D,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,IAAI,MAAM;IACpB;AACJ;AAEO,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,IAAA,gKAAQ,EAAC;IACxD,OAAO;IACP,GAAG,mIAAU;IACb,WAAW;QACP,MAAM,QAAO,EAAE,IAAI,EAAE,OAAO,EAAE;YAC1B,IAAI,SAAS,aAAa,UAAU;gBAChC,MAAM,SAAS,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBAAE,OAAO,KAAK,KAAK;oBAAW;gBACzC;gBACA,OAAO,CAAC,CAAC,QAAQ,6BAA6B;YAClD;YACA,OAAO;QACX;QACA,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE;YACvC,IAAI,MAAM;gBACN,gBAAgB;gBAChB,MAAM,SAAS,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAAE,OAAO;wBAAE,OAAO,KAAK,KAAK;oBAAW;gBAAE;gBACrF,MAAM,EAAE,GAAG,QAAQ,MAAM,KAAK,EAAE;gBAChC,MAAM,IAAI,GAAG,QAAQ,QAAQ;YACjC;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,QAAQ,IAAI,EAAE;gBACd,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBACzB,QAAQ,IAAI,CAAS,IAAI,GAAG,MAAM,IAAI;YAC3C;YACA,OAAO;QACX;IACJ;IACA,WAAW;QACP,IAAA,qKAAW,EAAC;YACR,MAAM,WAAU,WAAW;gBACvB,MAAM,oBAAoB,kLAAC,CACtB,MAAM,CAAC;oBAAE,OAAO,kLAAC,CAAC,MAAM,GAAG,KAAK;oBAAI,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;gBAAG,GAChE,SAAS,CAAC;gBAEf,IAAI,kBAAkB,OAAO,EAAE;oBAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,kBAAkB,IAAI;oBAClD,MAAM,OAAO,MAAM,QAAQ;oBAC3B,IAAI,CAAC,MAAM,OAAO;oBAClB,IAAI,CAAC,KAAK,QAAQ,EAAE,OAAO,MAAM,2BAA2B;oBAE5D,MAAM,iBAAiB,MAAM,4IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;oBACnE,IAAI,gBAAgB,OAAO;gBAC/B;gBAEA,QAAQ,GAAG,CAAC;gBACZ,OAAO;YACX;QACJ;KACH;AACL"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/app/dashboard/dashboard-layout-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/dashboard/dashboard-layout-client.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/dashboard/dashboard-layout-client.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAiT,GAC9U,+EACA","ignoreList":[0]}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/app/dashboard/dashboard-layout-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/dashboard/dashboard-layout-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/dashboard/dashboard-layout-client.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA6R,GAC1T,2DACA","ignoreList":[0]}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/roles.ts"],"sourcesContent":["/**\r\n * Sistema central de roles y permisos.\r\n * Los permisos \"fijos\" se definen aqu√≠; la tabla RolePermission en DB\r\n * permite que el ADMIN los ajuste without redeploy para SUB_COMISION,\r\n * COORDINADOR y ENTRENADOR.\r\n * ADMIN siempre tiene todos los permisos y no es editable.\r\n */\r\n\r\nexport const ROLES = {\r\n    ADMIN: 'ADMIN',\r\n    SUB_COMISION: 'SUB_COMISION',\r\n    COORDINADOR: 'COORDINADOR',\r\n    ENTRENADOR: 'ENTRENADOR',\r\n} as const;\r\n\r\nexport type Role = (typeof ROLES)[keyof typeof ROLES];\r\n\r\n// Lista de todos los permisos posibles del sistema\r\nexport const PERMISSIONS = {\r\n    // Jugadores\r\n    VIEW_PLAYERS: 'view_players',\r\n    EDIT_PLAYERS: 'edit_players',\r\n    // Entrenadores\r\n    VIEW_COACHES: 'view_coaches',\r\n    EDIT_COACHES: 'edit_coaches',\r\n    VIEW_COACH_SALARY: 'view_coach_salary',\r\n    // Equipos / Categor√≠as\r\n    VIEW_TEAMS: 'view_teams',\r\n    // Pagos\r\n    VIEW_PAYMENTS: 'view_payments',\r\n    // Asistencia\r\n    TAKE_ATTENDANCE: 'take_attendance',\r\n    // Informes\r\n    VIEW_REPORT_ATTENDANCE: 'view_report_attendance',\r\n    VIEW_REPORT_SALARIES: 'view_report_salaries',\r\n    VIEW_REPORT_PAYMENTS: 'view_report_payments',\r\n    // Administraci√≥n\r\n    ACCESS_ADMIN: 'access_admin',\r\n    MANAGE_USERS: 'manage_users',\r\n    MANAGE_CATEGORY_MAPPING: 'manage_category_mapping',\r\n    IMPORT_DATA: 'import_data',\r\n    VIEW_AUDIT: 'view_audit',\r\n    MANAGE_DUPLICATES: 'manage_duplicates',\r\n    BACKUP_EXPORT: 'backup_export',\r\n    BACKUP_RESTORE: 'backup_restore',\r\n} as const;\r\n\r\nexport type Permission = (typeof PERMISSIONS)[keyof typeof PERMISSIONS];\r\n\r\n/** Permisos por defecto para cada rol (usados al inicializar la app) */\r\nexport const DEFAULT_ROLE_PERMISSIONS: Record<Role, Permission[]> = {\r\n    ADMIN: Object.values(PERMISSIONS) as Permission[],\r\n\r\n    SUB_COMISION: [\r\n        PERMISSIONS.VIEW_PLAYERS,\r\n        PERMISSIONS.EDIT_PLAYERS,\r\n        PERMISSIONS.VIEW_COACHES,\r\n        PERMISSIONS.EDIT_COACHES,\r\n        PERMISSIONS.VIEW_COACH_SALARY,\r\n        PERMISSIONS.VIEW_TEAMS,\r\n        PERMISSIONS.VIEW_PAYMENTS,\r\n        PERMISSIONS.TAKE_ATTENDANCE,\r\n        PERMISSIONS.VIEW_REPORT_ATTENDANCE,\r\n        PERMISSIONS.VIEW_REPORT_SALARIES,\r\n        PERMISSIONS.VIEW_REPORT_PAYMENTS,\r\n        PERMISSIONS.ACCESS_ADMIN,\r\n        PERMISSIONS.MANAGE_CATEGORY_MAPPING,\r\n        PERMISSIONS.VIEW_AUDIT,\r\n        PERMISSIONS.BACKUP_EXPORT,\r\n    ],\r\n\r\n    COORDINADOR: [\r\n        PERMISSIONS.VIEW_PLAYERS,\r\n        PERMISSIONS.EDIT_PLAYERS,\r\n        PERMISSIONS.VIEW_COACHES,\r\n        PERMISSIONS.VIEW_TEAMS,\r\n        PERMISSIONS.TAKE_ATTENDANCE,\r\n        PERMISSIONS.VIEW_REPORT_ATTENDANCE,\r\n        PERMISSIONS.VIEW_REPORT_SALARIES,\r\n        PERMISSIONS.VIEW_REPORT_PAYMENTS,\r\n    ],\r\n\r\n    ENTRENADOR: [\r\n        PERMISSIONS.VIEW_PLAYERS,\r\n        PERMISSIONS.VIEW_COACHES,\r\n        PERMISSIONS.VIEW_TEAMS,\r\n        PERMISSIONS.TAKE_ATTENDANCE,\r\n        PERMISSIONS.VIEW_REPORT_ATTENDANCE,\r\n    ],\r\n};\r\n\r\n/** Labels legibles para mostrar en el panel de gesti√≥n de permisos */\r\nexport const PERMISSION_LABELS: Record<Permission, string> = {\r\n    view_players: 'Ver Jugadores',\r\n    edit_players: 'Editar/Crear Jugadores',\r\n    view_coaches: 'Ver Entrenadores',\r\n    edit_coaches: 'Editar/Crear Entrenadores',\r\n    view_coach_salary: 'Ver Sueldos de Entrenadores',\r\n    view_teams: 'Ver Equipos/Categor√≠as',\r\n    view_payments: 'Ver y Gestionar Pagos',\r\n    take_attendance: 'Tomar Asistencia',\r\n    view_report_attendance: 'Informe de Asistencia',\r\n    view_report_salaries: 'Informe de Sueldos',\r\n    view_report_payments: 'Informe de Pagos',\r\n    access_admin: 'Acceder al Panel de Administraci√≥n',\r\n    manage_users: 'Gestionar Usuarios',\r\n    manage_category_mapping: 'Mapeo de Categor√≠as',\r\n    import_data: 'Importar Datos',\r\n    view_audit: 'Ver Auditor√≠a',\r\n    manage_duplicates: 'Gestionar Duplicados',\r\n    backup_export: 'Exportar Backup',\r\n    backup_restore: 'Restaurar Backup',\r\n};\r\n\r\nexport const PERMISSION_GROUPS: { label: string; permissions: Permission[] }[] = [\r\n    {\r\n        label: 'üèÄ Jugadores',\r\n        permissions: [PERMISSIONS.VIEW_PLAYERS, PERMISSIONS.EDIT_PLAYERS],\r\n    },\r\n    {\r\n        label: 'üß¢ Entrenadores',\r\n        permissions: [PERMISSIONS.VIEW_COACHES, PERMISSIONS.EDIT_COACHES, PERMISSIONS.VIEW_COACH_SALARY],\r\n    },\r\n    {\r\n        label: 'üõ°Ô∏è Equipos & Asistencia',\r\n        permissions: [PERMISSIONS.VIEW_TEAMS, PERMISSIONS.TAKE_ATTENDANCE],\r\n    },\r\n    {\r\n        label: 'üí∞ Pagos',\r\n        permissions: [PERMISSIONS.VIEW_PAYMENTS],\r\n    },\r\n    {\r\n        label: 'üìä Informes',\r\n        permissions: [\r\n            PERMISSIONS.VIEW_REPORT_ATTENDANCE,\r\n            PERMISSIONS.VIEW_REPORT_SALARIES,\r\n            PERMISSIONS.VIEW_REPORT_PAYMENTS,\r\n        ],\r\n    },\r\n    {\r\n        label: '‚öôÔ∏è Administraci√≥n',\r\n        permissions: [\r\n            PERMISSIONS.ACCESS_ADMIN,\r\n            PERMISSIONS.MANAGE_USERS,\r\n            PERMISSIONS.MANAGE_CATEGORY_MAPPING,\r\n            PERMISSIONS.IMPORT_DATA,\r\n            PERMISSIONS.VIEW_AUDIT,\r\n            PERMISSIONS.MANAGE_DUPLICATES,\r\n            PERMISSIONS.BACKUP_EXPORT,\r\n            PERMISSIONS.BACKUP_RESTORE,\r\n        ],\r\n    },\r\n];\r\n\r\n/** ADMIN siempre tiene todos los permisos sin ir a la BD */\r\nexport function isAdmin(role: string): boolean {\r\n    return role === ROLES.ADMIN;\r\n}\r\n\r\nexport const EDITABLE_ROLES: Role[] = [ROLES.SUB_COMISION, ROLES.COORDINADOR, ROLES.ENTRENADOR];\r\n"],"names":[],"mappings":"AAAA;;;;;;CAMC;;;;;;;;;;;;;;;;AAEM,MAAM,QAAQ;IACjB,OAAO;IACP,cAAc;IACd,aAAa;IACb,YAAY;AAChB;AAKO,MAAM,cAAc;IACvB,YAAY;IACZ,cAAc;IACd,cAAc;IACd,eAAe;IACf,cAAc;IACd,cAAc;IACd,mBAAmB;IACnB,uBAAuB;IACvB,YAAY;IACZ,QAAQ;IACR,eAAe;IACf,aAAa;IACb,iBAAiB;IACjB,WAAW;IACX,wBAAwB;IACxB,sBAAsB;IACtB,sBAAsB;IACtB,iBAAiB;IACjB,cAAc;IACd,cAAc;IACd,yBAAyB;IACzB,aAAa;IACb,YAAY;IACZ,mBAAmB;IACnB,eAAe;IACf,gBAAgB;AACpB;AAKO,MAAM,2BAAuD;IAChE,OAAO,OAAO,MAAM,CAAC;IAErB,cAAc;QACV,YAAY,YAAY;QACxB,YAAY,YAAY;QACxB,YAAY,YAAY;QACxB,YAAY,YAAY;QACxB,YAAY,iBAAiB;QAC7B,YAAY,UAAU;QACtB,YAAY,aAAa;QACzB,YAAY,eAAe;QAC3B,YAAY,sBAAsB;QAClC,YAAY,oBAAoB;QAChC,YAAY,oBAAoB;QAChC,YAAY,YAAY;QACxB,YAAY,uBAAuB;QACnC,YAAY,UAAU;QACtB,YAAY,aAAa;KAC5B;IAED,aAAa;QACT,YAAY,YAAY;QACxB,YAAY,YAAY;QACxB,YAAY,YAAY;QACxB,YAAY,UAAU;QACtB,YAAY,eAAe;QAC3B,YAAY,sBAAsB;QAClC,YAAY,oBAAoB;QAChC,YAAY,oBAAoB;KACnC;IAED,YAAY;QACR,YAAY,YAAY;QACxB,YAAY,YAAY;QACxB,YAAY,UAAU;QACtB,YAAY,eAAe;QAC3B,YAAY,sBAAsB;KACrC;AACL;AAGO,MAAM,oBAAgD;IACzD,cAAc;IACd,cAAc;IACd,cAAc;IACd,cAAc;IACd,mBAAmB;IACnB,YAAY;IACZ,eAAe;IACf,iBAAiB;IACjB,wBAAwB;IACxB,sBAAsB;IACtB,sBAAsB;IACtB,cAAc;IACd,cAAc;IACd,yBAAyB;IACzB,aAAa;IACb,YAAY;IACZ,mBAAmB;IACnB,eAAe;IACf,gBAAgB;AACpB;AAEO,MAAM,oBAAoE;IAC7E;QACI,OAAO;QACP,aAAa;YAAC,YAAY,YAAY;YAAE,YAAY,YAAY;SAAC;IACrE;IACA;QACI,OAAO;QACP,aAAa;YAAC,YAAY,YAAY;YAAE,YAAY,YAAY;YAAE,YAAY,iBAAiB;SAAC;IACpG;IACA;QACI,OAAO;QACP,aAAa;YAAC,YAAY,UAAU;YAAE,YAAY,eAAe;SAAC;IACtE;IACA;QACI,OAAO;QACP,aAAa;YAAC,YAAY,aAAa;SAAC;IAC5C;IACA;QACI,OAAO;QACP,aAAa;YACT,YAAY,sBAAsB;YAClC,YAAY,oBAAoB;YAChC,YAAY,oBAAoB;SACnC;IACL;IACA;QACI,OAAO;QACP,aAAa;YACT,YAAY,YAAY;YACxB,YAAY,YAAY;YACxB,YAAY,uBAAuB;YACnC,YAAY,WAAW;YACvB,YAAY,UAAU;YACtB,YAAY,iBAAiB;YAC7B,YAAY,aAAa;YACzB,YAAY,cAAc;SAC7B;IACL;CACH;AAGM,SAAS,QAAQ,IAAY;IAChC,OAAO,SAAS,MAAM,KAAK;AAC/B;AAEO,MAAM,iBAAyB;IAAC,MAAM,YAAY;IAAE,MAAM,WAAW;IAAE,MAAM,UAAU;CAAC"}},
    {"offset": {"line": 370, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/role-permission-actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { auth } from '@/auth';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { ROLES, PERMISSIONS, DEFAULT_ROLE_PERMISSIONS, type Role, type Permission, EDITABLE_ROLES } from './roles';\r\n\r\nfunction generateId(): string {\r\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\r\n}\r\n\r\n/**\r\n * Obtiene los permisos para un rol.\r\n * ADMIN siempre recibe todos los permisos sin consultar la BD.\r\n * Para el resto, usa la BD (inicializando con defaults si no existen).\r\n */\r\nexport async function getPermissionsForRole(role: string): Promise<Permission[]> {\r\n    if (role === ROLES.ADMIN) {\r\n        return Object.values(PERMISSIONS) as Permission[];\r\n    }\r\n\r\n    const roleKey = role as Role;\r\n    if (!EDITABLE_ROLES.includes(roleKey)) return [];\r\n\r\n    const dbPerms = await (prisma as any).rolePermission.findMany({\r\n        where: { role },\r\n    });\r\n\r\n    // Si no hay registros en la BD, inicializar con defaults\r\n    if (dbPerms.length === 0) {\r\n        await initializeDefaultPermissions(roleKey);\r\n        return DEFAULT_ROLE_PERMISSIONS[roleKey] || [];\r\n    }\r\n\r\n    return dbPerms\r\n        .filter((p: any) => p.enabled)\r\n        .map((p: any) => p.permission as Permission);\r\n}\r\n\r\n/**\r\n * Carga todos los permisos de todos los roles editables para el panel admin.\r\n * Retorna un mapa: { role -> { permission -> enabled } }\r\n */\r\nexport async function getAllRolePermissions(): Promise<Record<string, Record<string, boolean>>> {\r\n    const result: Record<string, Record<string, boolean>> = {};\r\n\r\n    for (const role of EDITABLE_ROLES) {\r\n        const dbPerms = await (prisma as any).rolePermission.findMany({ where: { role } });\r\n\r\n        // Inicializar con defaults si la tabla est√° vac√≠a para este rol\r\n        if (dbPerms.length === 0) {\r\n            await initializeDefaultPermissions(role);\r\n        }\r\n\r\n        result[role] = {};\r\n        const allPerms = Object.values(PERMISSIONS) as Permission[];\r\n        const defaults = DEFAULT_ROLE_PERMISSIONS[role] || [];\r\n\r\n        for (const perm of allPerms) {\r\n            const dbPerm = dbPerms.find((p: any) => p.permission === perm);\r\n            result[role][perm] = dbPerm ? dbPerm.enabled : defaults.includes(perm);\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nasync function initializeDefaultPermissions(role: Role) {\r\n    const defaults = DEFAULT_ROLE_PERMISSIONS[role] || [];\r\n    const allPerms = Object.values(PERMISSIONS) as Permission[];\r\n    const now = new Date();\r\n\r\n    for (const perm of allPerms) {\r\n        try {\r\n            await (prisma as any).rolePermission.upsert({\r\n                where: { role_permission: { role, permission: perm } },\r\n                update: {},\r\n                create: {\r\n                    id: generateId(),\r\n                    role,\r\n                    permission: perm,\r\n                    enabled: defaults.includes(perm),\r\n                    updatedAt: now,\r\n                },\r\n            });\r\n        } catch {\r\n            // Si ya existe, ignorar\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Actualiza un permiso espec√≠fico para un rol (solo ADMIN puede hacerlo).\r\n */\r\nexport async function updateRolePermission(\r\n    role: string,\r\n    permission: string,\r\n    enabled: boolean\r\n): Promise<{ success: boolean; message?: string }> {\r\n    const session = await auth();\r\n    if ((session?.user as any)?.role !== ROLES.ADMIN) {\r\n        return { success: false, message: 'No autorizado' };\r\n    }\r\n\r\n    if (role === ROLES.ADMIN) {\r\n        return { success: false, message: 'Los permisos de ADMIN no son editables' };\r\n    }\r\n\r\n    try {\r\n        await (prisma as any).rolePermission.upsert({\r\n            where: { role_permission: { role, permission } },\r\n            update: { enabled, updatedAt: new Date() },\r\n            create: {\r\n                id: generateId(),\r\n                role,\r\n                permission,\r\n                enabled,\r\n                updatedAt: new Date(),\r\n            },\r\n        });\r\n\r\n        revalidatePath('/dashboard/administracion/roles');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { success: false, message: error.message };\r\n    }\r\n}\r\n\r\n/**\r\n * Verifica si un rol tiene un permiso espec√≠fico.\r\n * Usa la BD (o defaults si no inicializado).\r\n */\r\nexport async function hasPermission(role: string, permission: Permission): Promise<boolean> {\r\n    if (role === ROLES.ADMIN) return true;\r\n    const perms = await getPermissionsForRole(role);\r\n    return perms.includes(permission);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 526, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/app/dashboard/layout.tsx"],"sourcesContent":["import { auth } from \"@/auth\";\r\nimport DashboardLayoutClient from \"./dashboard-layout-client\";\r\nimport { getPermissionsForRole } from \"@/lib/role-permission-actions\";\r\n\r\nexport default async function DashboardLayout({\r\n    children,\r\n}: {\r\n    children: React.ReactNode;\r\n}) {\r\n    const session = await auth();\r\n    const role = (session?.user as any)?.role || 'ENTRENADOR';\r\n    const userName = session?.user?.name;\r\n    const permissions = await getPermissionsForRole(role);\r\n\r\n    return (\r\n        <DashboardLayoutClient role={role} userName={userName} permissions={permissions}>\r\n            {children}\r\n        </DashboardLayoutClient>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAEe,eAAe,gBAAgB,EAC1C,QAAQ,EAGX;IACG,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,MAAM,OAAO,AAAC,SAAS,MAAc,QAAQ;IAC7C,MAAM,WAAW,SAAS,MAAM;IAChC,MAAM,cAAc,MAAM,IAAA,oKAAqB,EAAC;IAEhD,qBACI,8OAAC,oKAAqB;QAAC,MAAM;QAAM,UAAU;QAAU,aAAa;kBAC/D;;;;;;AAGb"}}]
}