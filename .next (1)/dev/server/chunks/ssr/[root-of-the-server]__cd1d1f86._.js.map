{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/auth.config.ts"],"sourcesContent":["import type { NextAuthConfig } from 'next-auth';\r\n\r\nexport const authConfig = {\r\n    pages: {\r\n        signIn: '/login',\r\n    },\r\n    callbacks: {\r\n        authorized({ auth, request: { nextUrl } }) {\r\n            const isLoggedIn = !!auth?.user;\r\n            const isOnDashboard = nextUrl.pathname.startsWith('/dashboard');\r\n            const isLoginPage = nextUrl.pathname === '/login';\r\n            const isRootPage = nextUrl.pathname === '/';\r\n\r\n            console.log('Middleware Authorized Check:', { pathname: nextUrl.pathname, isLoggedIn });\r\n\r\n            if (isOnDashboard) {\r\n                if (isLoggedIn) return true;\r\n                return false; // Redirect unauthenticated users to login page\r\n            } else if (isLoggedIn && (isLoginPage || isRootPage)) {\r\n                return Response.redirect(new URL('/dashboard', nextUrl));\r\n            }\r\n            return true;\r\n        },\r\n    },\r\n    providers: [], // Add providers with an empty array for now\r\n} satisfies NextAuthConfig;\r\n"],"names":[],"mappings":";;;;AAEO,MAAM,aAAa;IACtB,OAAO;QACH,QAAQ;IACZ;IACA,WAAW;QACP,YAAW,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,EAAE;YACrC,MAAM,aAAa,CAAC,CAAC,MAAM;YAC3B,MAAM,gBAAgB,QAAQ,QAAQ,CAAC,UAAU,CAAC;YAClD,MAAM,cAAc,QAAQ,QAAQ,KAAK;YACzC,MAAM,aAAa,QAAQ,QAAQ,KAAK;YAExC,QAAQ,GAAG,CAAC,gCAAgC;gBAAE,UAAU,QAAQ,QAAQ;gBAAE;YAAW;YAErF,IAAI,eAAe;gBACf,IAAI,YAAY,OAAO;gBACvB,OAAO,OAAO,+CAA+C;YACjE,OAAO,IAAI,cAAc,CAAC,eAAe,UAAU,GAAG;gBAClD,OAAO,SAAS,QAAQ,CAAC,IAAI,IAAI,cAAc;YACnD;YACA,OAAO;QACX;IACJ;IACA,WAAW,EAAE;AACjB"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n    globalForPrisma.prisma ||\r\n    new PrismaClient({\r\n        log: ['query'],\r\n    });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACT,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACb,KAAK;QAAC;KAAQ;AAClB;AAEJ,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/auth.ts"],"sourcesContent":["import NextAuth from 'next-auth';\r\nimport { authConfig } from './auth.config';\r\nimport Credentials from 'next-auth/providers/credentials';\r\nimport { z } from 'zod';\r\nimport { prisma } from '@/lib/prisma';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nimport Google from 'next-auth/providers/google';\r\n\r\nasync function getUser(email: string) {\r\n    try {\r\n        const user = await prisma.user.findUnique({ where: { email } });\r\n        return user;\r\n    } catch (error) {\r\n        console.error('Failed to fetch user:', error);\r\n        throw new Error('Failed to fetch user.');\r\n    }\r\n}\r\n\r\nexport const { auth, signIn, signOut, handlers } = NextAuth({\r\n    debug: true,\r\n    ...authConfig,\r\n    callbacks: {\r\n        async signIn({ user, account }) {\r\n            if (account?.provider === \"google\") {\r\n                const dbUser = await prisma.user.findUnique({\r\n                    where: { email: user.email as string }\r\n                });\r\n                return !!dbUser; // Only allow if exists in DB\r\n            }\r\n            return true;\r\n        },\r\n        async jwt({ token, user, trigger, session }) {\r\n            if (user) {\r\n                // Initial login\r\n                const dbUser = await prisma.user.findUnique({ where: { email: user.email as string } });\r\n                token.id = dbUser?.id || user.id;\r\n                token.role = dbUser?.role || 'VIEWER';\r\n            }\r\n            return token;\r\n        },\r\n        async session({ session, token }) {\r\n            if (session.user) {\r\n                session.user.id = token.id as string;\r\n                (session.user as any).role = token.role as string;\r\n            }\r\n            return session;\r\n        },\r\n    },\r\n    providers: [\r\n        Credentials({\r\n            async authorize(credentials) {\r\n                const parsedCredentials = z\r\n                    .object({ email: z.string().email(), password: z.string().min(6) })\r\n                    .safeParse(credentials);\r\n\r\n                if (parsedCredentials.success) {\r\n                    const { email, password } = parsedCredentials.data;\r\n                    const user = await getUser(email);\r\n                    if (!user) return null;\r\n                    if (!user.password) return null; // User might be OAuth only\r\n\r\n                    const passwordsMatch = await bcrypt.compare(password, user.password);\r\n                    if (passwordsMatch) return user;\r\n                }\r\n\r\n                console.log('Invalid credentials');\r\n                return null;\r\n            },\r\n        }),\r\n    ],\r\n});\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;AAIA,eAAe,QAAQ,KAAa;IAChC,IAAI;QACA,MAAM,OAAO,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC7D,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,IAAI,MAAM;IACpB;AACJ;AAEO,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,IAAA,gKAAQ,EAAC;IACxD,OAAO;IACP,GAAG,mIAAU;IACb,WAAW;QACP,MAAM,QAAO,EAAE,IAAI,EAAE,OAAO,EAAE;YAC1B,IAAI,SAAS,aAAa,UAAU;gBAChC,MAAM,SAAS,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBAAE,OAAO,KAAK,KAAK;oBAAW;gBACzC;gBACA,OAAO,CAAC,CAAC,QAAQ,6BAA6B;YAClD;YACA,OAAO;QACX;QACA,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE;YACvC,IAAI,MAAM;gBACN,gBAAgB;gBAChB,MAAM,SAAS,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBAAE,OAAO;wBAAE,OAAO,KAAK,KAAK;oBAAW;gBAAE;gBACrF,MAAM,EAAE,GAAG,QAAQ,MAAM,KAAK,EAAE;gBAChC,MAAM,IAAI,GAAG,QAAQ,QAAQ;YACjC;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,QAAQ,IAAI,EAAE;gBACd,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBACzB,QAAQ,IAAI,CAAS,IAAI,GAAG,MAAM,IAAI;YAC3C;YACA,OAAO;QACX;IACJ;IACA,WAAW;QACP,IAAA,qKAAW,EAAC;YACR,MAAM,WAAU,WAAW;gBACvB,MAAM,oBAAoB,kLAAC,CACtB,MAAM,CAAC;oBAAE,OAAO,kLAAC,CAAC,MAAM,GAAG,KAAK;oBAAI,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;gBAAG,GAChE,SAAS,CAAC;gBAEf,IAAI,kBAAkB,OAAO,EAAE;oBAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,kBAAkB,IAAI;oBAClD,MAAM,OAAO,MAAM,QAAQ;oBAC3B,IAAI,CAAC,MAAM,OAAO;oBAClB,IAAI,CAAC,KAAK,QAAQ,EAAE,OAAO,MAAM,2BAA2B;oBAE5D,MAAM,iBAAiB,MAAM,4IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;oBACnE,IAAI,gBAAgB,OAAO;gBAC/B;gBAEA,QAAQ,GAAG,CAAC;gBACZ,OAAO;YACX;QACJ;KACH;AACL"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/auth-actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { signIn } from '@/auth';\r\nimport { AuthError } from 'next-auth';\r\n\r\nexport async function authenticate(\r\n    prevState: string | undefined,\r\n    formData: FormData,\r\n) {\r\n    try {\r\n        await signIn('credentials', { ...Object.fromEntries(formData), redirectTo: '/dashboard' });\r\n    } catch (error) {\r\n        console.log('Auth Error:', error);\r\n        if (error instanceof AuthError) {\r\n            switch (error.type) {\r\n                case 'CredentialsSignin':\r\n                    return 'Invalid credentials.';\r\n                default:\r\n                    return 'Something went wrong.';\r\n            }\r\n        }\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function signInWithGoogle() {\r\n    await signIn('google', { redirectTo: '/dashboard' });\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;;;;;AAEO,eAAe,aAClB,SAA6B,EAC7B,QAAkB;IAElB,IAAI;QACA,MAAM,IAAA,qHAAM,EAAC,eAAe;YAAE,GAAG,OAAO,WAAW,CAAC,SAAS;YAAE,YAAY;QAAa;IAC5F,EAAE,OAAO,OAAO;QACZ,QAAQ,GAAG,CAAC,eAAe;QAC3B,IAAI,iBAAiB,qJAAS,EAAE;YAC5B,OAAQ,MAAM,IAAI;gBACd,KAAK;oBACD,OAAO;gBACX;oBACI,OAAO;YACf;QACJ;QACA,MAAM;IACV;AACJ;AAEO,eAAe;IAClB,MAAM,IAAA,qHAAM,EAAC,UAAU;QAAE,YAAY;IAAa;AACtD;;;IAtBsB;IAoBA;;AApBA,+OAAA;AAoBA,+OAAA"}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/.next-internal/server/app/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {authenticate as '60b108e836df8a48a6cc031b6a67c585b6e43fecfa'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}