{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/app/dashboard/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { signOut } from \"@/auth\";\r\n\r\nexport async function handleSignOut() {\r\n    await signOut();\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEO,eAAe;IAClB,MAAM,IAAA,sHAAO;AACjB;;;IAFsB;;AAAA,+OAAA"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/utils.ts"],"sourcesContent":["export function getCategory(player: any, mappings?: { category: string, minYear: number, maxYear: number }[]): string {\r\n    // 1. Manual override priority\r\n    if (player.category) return player.category;\r\n\r\n    // 2. BirthDate logic\r\n    if (!player.birthDate) return \"REVISAR\";\r\n\r\n    const date = new Date(player.birthDate);\r\n    if (isNaN(date.getTime()) || date.getTime() <= 0) return \"REVISAR\";\r\n\r\n    const year = date.getFullYear();\r\n    if (year <= 1970) return \"REVISAR\";\r\n\r\n    if (mappings && mappings.length > 0) {\r\n        const found = mappings.find(m => year >= m.minYear && year <= m.maxYear);\r\n        if (found) return found.category;\r\n    }\r\n\r\n    const today = new Date();\r\n    const currentYear = today.getFullYear();\r\n    const age = currentYear - year;\r\n\r\n    if (age < 9) return \"Mosquitos\";\r\n    if (age <= 10) return \"Pre-Mini\";\r\n    if (age <= 12) return \"Mini\";\r\n    if (age <= 13) return \"U13\";\r\n    if (age <= 15) return \"U15\";\r\n    if (age <= 17) return \"U17\";\r\n    if (age <= 19) return \"U19\";\r\n    return \"Primera\";\r\n}\r\n\r\nexport function formatCurrency(amount: number) {\r\n    return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(amount);\r\n}\r\n\r\n/**\r\n * Re-evaluates player status. \r\n * If status is REVISAR and all critical data is now present and real,\r\n * it returns ACTIVO. Otherwise returns the existing status.\r\n */\r\nexport function evaluatePlayerStatus(currentStatus: string, dni: string, birthDate: Date | null | string): string {\r\n    if (currentStatus !== 'REVISAR') return currentStatus;\r\n\r\n    if (!dni || dni.startsWith('TEMP-')) return 'REVISAR';\r\n\r\n    if (!birthDate) return 'REVISAR';\r\n    const date = birthDate instanceof Date ? birthDate : new Date(birthDate);\r\n    if (isNaN(date.getTime())) return 'REVISAR';\r\n\r\n    const year = date.getFullYear();\r\n    // Default/Legacy invalid years\r\n    if (year <= 1970 || year === 1900) return 'REVISAR';\r\n\r\n    // If we are here, data is real and complete. Auto-promote to ACTIVO.\r\n    return 'ACTIVO';\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAO,SAAS,YAAY,MAAW,EAAE,QAAmE;IACxG,8BAA8B;IAC9B,IAAI,OAAO,QAAQ,EAAE,OAAO,OAAO,QAAQ;IAE3C,qBAAqB;IACrB,IAAI,CAAC,OAAO,SAAS,EAAE,OAAO;IAE9B,MAAM,OAAO,IAAI,KAAK,OAAO,SAAS;IACtC,IAAI,MAAM,KAAK,OAAO,OAAO,KAAK,OAAO,MAAM,GAAG,OAAO;IAEzD,MAAM,OAAO,KAAK,WAAW;IAC7B,IAAI,QAAQ,MAAM,OAAO;IAEzB,IAAI,YAAY,SAAS,MAAM,GAAG,GAAG;QACjC,MAAM,QAAQ,SAAS,IAAI,CAAC,CAAA,IAAK,QAAQ,EAAE,OAAO,IAAI,QAAQ,EAAE,OAAO;QACvE,IAAI,OAAO,OAAO,MAAM,QAAQ;IACpC;IAEA,MAAM,QAAQ,IAAI;IAClB,MAAM,cAAc,MAAM,WAAW;IACrC,MAAM,MAAM,cAAc;IAE1B,IAAI,MAAM,GAAG,OAAO;IACpB,IAAI,OAAO,IAAI,OAAO;IACtB,IAAI,OAAO,IAAI,OAAO;IACtB,IAAI,OAAO,IAAI,OAAO;IACtB,IAAI,OAAO,IAAI,OAAO;IACtB,IAAI,OAAO,IAAI,OAAO;IACtB,IAAI,OAAO,IAAI,OAAO;IACtB,OAAO;AACX;AAEO,SAAS,eAAe,MAAc;IACzC,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QAAE,OAAO;QAAY,UAAU;IAAM,GAAG,MAAM,CAAC;AACzF;AAOO,SAAS,qBAAqB,aAAqB,EAAE,GAAW,EAAE,SAA+B;IACpG,IAAI,kBAAkB,WAAW,OAAO;IAExC,IAAI,CAAC,OAAO,IAAI,UAAU,CAAC,UAAU,OAAO;IAE5C,IAAI,CAAC,WAAW,OAAO;IACvB,MAAM,OAAO,qBAAqB,OAAO,YAAY,IAAI,KAAK;IAC9D,IAAI,MAAM,KAAK,OAAO,KAAK,OAAO;IAElC,MAAM,OAAO,KAAK,WAAW;IAC7B,+BAA+B;IAC/B,IAAI,QAAQ,QAAQ,SAAS,MAAM,OAAO;IAE1C,qEAAqE;IACrE,OAAO;AACX"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { auth } from \"@/auth\";\r\nimport { revalidatePath } from \"next/cache\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { z } from \"zod\";\r\nimport { evaluatePlayerStatus } from \"./utils\";\r\n\r\n\r\nconst FormSchema = z.object({\r\n    firstName: z.string().min(1, \"Nombre es obligatorio\"),\r\n    lastName: z.string().min(1, \"Apellido es obligatorio\"),\r\n    dni: z.string()\r\n        .min(1, \"DNI es obligatorio\")\r\n        .refine(\r\n            (val) => /^\\d{7,12}$/.test(val) || /^TEMP-/.test(val),\r\n            \"El DNI debe tener entre 7 y 12 dígitos, o comenzar con TEMP-\"\r\n        ),\r\n    birthDate: z.string().min(1, \"Fecha de nacimiento es obligatoria\"),\r\n    tira: z.string(), // \"Femenino\", \"Masculino A\", \"Masculino B\"\r\n    scholarship: z.boolean().optional(),\r\n    playsPrimera: z.boolean().optional(),\r\n    email: z.string().email().optional().or(z.literal(\"\")),\r\n    phone: z.string().optional().refine(\r\n        (val) => !val || /^\\+?\\d+$/.test(val),\r\n        \"El teléfono debe contener solo números, opcionalmente iniciando con '+\"\r\n    ),\r\n    partnerNumber: z.string().optional(),\r\n    contactName: z.string().optional(),\r\n    shirtNumber: z.coerce.number().optional(),\r\n    observations: z.string().optional(),\r\n    registrationDate: z.string().optional(),\r\n    withdrawalDate: z.string().optional(),\r\n    status: z.enum([\"ACTIVO\", \"INACTIVO\", \"REVISAR\"]).default(\"ACTIVO\"),\r\n    siblings: z.string().optional(),\r\n    category: z.string().optional(),\r\n    federationYear: z.coerce.number().optional(),\r\n    federationInstallments: z.string().optional(),\r\n});\r\n\r\nfunction sanitizeDNI(dni: any): string {\r\n    if (!dni) return `TEMP-${Date.now()}`;\r\n    const str = String(dni);\r\n    // Preserve TEMP- prefix if already set\r\n    if (str.startsWith('TEMP-')) return str;\r\n    const sanitized = str.replace(/\\D/g, \"\");\r\n    return sanitized.length > 0 ? sanitized : `TEMP-${Date.now()}`;\r\n}\r\n\r\nexport async function createAuditLog(action: string, entity: string, entityId: string, details?: any) {\r\n    const session = await auth();\r\n    const userId = session?.user?.id;\r\n\r\n    if (userId) {\r\n        // Double check if user exists in DB to avoid FK violations (e.g. after DB reset)\r\n        const userExists = await prisma.user.findUnique({ where: { id: userId } });\r\n\r\n        await prisma.auditLog.create({\r\n            data: {\r\n                action,\r\n                entity,\r\n                entityId,\r\n                details: details ? JSON.stringify(details) : null,\r\n                userId: userExists ? userId : null,\r\n            },\r\n        });\r\n    }\r\n}\r\n\r\nexport async function createPlayer(prevState: any, formData: FormData) {\r\n    const session = await auth();\r\n    const role = (session?.user as any)?.role || 'VIEWER';\r\n    if (!session || (role !== 'ADMIN' && role !== 'OPERADOR')) {\r\n        return { message: \"No tiene permisos para realizar esta acción\", errors: undefined };\r\n    }\r\n\r\n    const scholarship = formData.get(\"scholarship\") === \"on\";\r\n    const federated = formData.get(\"federated\") === \"on\";\r\n    const playsPrimera = formData.get(\"playsPrimera\") === \"on\";\r\n    const shirtNumberRaw = formData.get(\"shirtNumber\");\r\n    const shirtNumber = (shirtNumberRaw && shirtNumberRaw !== \"\") ? parseInt(shirtNumberRaw.toString()) : null;\r\n\r\n    const rawData = {\r\n        firstName: formData.get(\"firstName\"),\r\n        lastName: formData.get(\"lastName\"),\r\n        dni: sanitizeDNI(formData.get(\"dni\")),\r\n        birthDate: formData.get(\"birthDate\"),\r\n        tira: formData.get(\"tira\"),\r\n        scholarship: scholarship,\r\n        federated: federated,\r\n        playsPrimera: playsPrimera,\r\n        email: formData.get(\"email\"),\r\n        phone: formData.get(\"phone\"),\r\n        // Extras\r\n        partnerNumber: formData.get(\"partnerNumber\"),\r\n        contactName: formData.get(\"contactName\"),\r\n        shirtNumber: shirtNumber,\r\n        observations: formData.get(\"observations\"),\r\n        registrationDate: formData.get(\"registrationDate\"),\r\n        status: formData.get(\"status\") || \"ACTIVO\",\r\n        siblings: formData.get(\"siblings\"),\r\n        category: formData.get(\"category\"),\r\n        federationYear: formData.get(\"federationYear\"),\r\n        federationInstallments: formData.get(\"federationInstallments\"),\r\n    };\r\n\r\n    const validatedFields = FormSchema.safeParse(rawData);\r\n\r\n    if (!validatedFields.success) {\r\n        console.log(validatedFields.error.flatten());\r\n        return {\r\n            errors: validatedFields.error.flatten().fieldErrors,\r\n            message: \"Faltan campos obligatorios.\",\r\n        };\r\n    }\r\n\r\n    const data = validatedFields.data;\r\n\r\n    // Shirt Number Validation (0-99, optional, adjacent categories)\r\n    if (shirtNumber !== null) {\r\n        if (shirtNumber < 0 || shirtNumber > 99) {\r\n            return { message: \"El número de camiseta debe estar entre 0 y 99.\", errors: { shirtNumber: [\"Rango inválido\"] } };\r\n        }\r\n        const shirtError = await validateShirtNumber(null, shirtNumber, data.tira, data.birthDate, data.category);\r\n        if (shirtError) return { message: shirtError, errors: { shirtNumber: [shirtError] } };\r\n    }\r\n\r\n    try {\r\n        const playerName = `${data.lastName.toUpperCase()}, ${data.firstName.toUpperCase()}`;\r\n        const player = await prisma.player.create({\r\n            data: {\r\n                firstName: data.firstName.toUpperCase(),\r\n                lastName: data.lastName.toUpperCase(),\r\n                dni: data.dni,\r\n                birthDate: new Date(data.birthDate), // Ensure valid date\r\n                tira: data.tira,\r\n                scholarship: scholarship,\r\n                federated: federated,\r\n                playsPrimera: playsPrimera,\r\n                email: data.email || null,\r\n                phone: data.phone || null,\r\n                partnerNumber: data.partnerNumber || null,\r\n                contactName: data.contactName ? data.contactName.toUpperCase() : null,\r\n                shirtNumber: data.shirtNumber || null,\r\n                observations: data.observations ? data.observations.toUpperCase() : null,\r\n                registrationDate: data.registrationDate ? new Date(data.registrationDate) : null,\r\n                siblings: data.siblings ? data.siblings.toUpperCase() : null,\r\n                category: data.category || null,\r\n                status: evaluatePlayerStatus(data.status, data.dni, data.birthDate),\r\n                federationYear: data.federationYear || null,\r\n                federationInstallments: data.federationInstallments || null,\r\n            } as any,\r\n        });\r\n\r\n        // Bidirectional siblings: Update all chosen siblings to include this new player\r\n        const siblingIds = formData.get(\"siblingIds\")?.toString();\r\n        if (siblingIds) {\r\n            const ids = siblingIds.split(',').filter(Boolean);\r\n            for (const sId of ids) {\r\n                const sPlayer = await prisma.player.findUnique({ where: { id: sId } }) as any;\r\n                if (sPlayer) {\r\n                    const currentSiblings = sPlayer.siblings ? sPlayer.siblings.split(';').map((s: string) => s.trim()) : [];\r\n                    if (!currentSiblings.includes(playerName)) {\r\n                        currentSiblings.push(playerName);\r\n                        await prisma.player.update({\r\n                            where: { id: sId },\r\n                            data: { siblings: currentSiblings.join('; ') }\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        await createAuditLog(\"CREATE\", \"Player\", player.id, rawData);\r\n    } catch (error: any) {\r\n        console.error(\"Create Player Error:\", error);\r\n        if (error.code === 'P2002') return { message: \"El DNI ya existe.\" };\r\n        return { message: \"Error al crear jugador: \" + error.message };\r\n    }\r\n\r\n    revalidatePath(\"/dashboard/players\");\r\n    redirect(\"/dashboard/players\");\r\n}\r\n\r\nexport type ActionState = {\r\n    message: string;\r\n    errors?: Record<string, string[]>;\r\n};\r\n\r\nexport async function updatePlayer(id: string, prevState: ActionState, formData: FormData): Promise<ActionState> {\r\n    const session = await auth();\r\n    const role = (session?.user as any)?.role || 'VIEWER';\r\n    if (!session || (role !== 'ADMIN' && role !== 'OPERADOR')) {\r\n        return { message: \"No tiene permisos para realizar esta acción\", errors: undefined };\r\n    }\r\n\r\n    const scholarship = formData.get(\"scholarship\") === \"on\";\r\n    const federated = formData.get(\"federated\") === \"on\";\r\n    const playsPrimera = formData.get(\"playsPrimera\") === \"on\";\r\n    const shirtNumberRaw = formData.get(\"shirtNumber\");\r\n    const shirtNumber = (shirtNumberRaw && shirtNumberRaw !== \"\") ? parseInt(shirtNumberRaw.toString()) : null;\r\n\r\n    const rawData = {\r\n        firstName: formData.get(\"firstName\"),\r\n        lastName: formData.get(\"lastName\"),\r\n        dni: sanitizeDNI(formData.get(\"dni\")),\r\n        birthDate: formData.get(\"birthDate\"),\r\n        tira: formData.get(\"tira\"),\r\n        scholarship: scholarship,\r\n        federated: federated,\r\n        playsPrimera: playsPrimera,\r\n        email: formData.get(\"email\"),\r\n        phone: formData.get(\"phone\"),\r\n        partnerNumber: formData.get(\"partnerNumber\"),\r\n        contactName: formData.get(\"contactName\"),\r\n        shirtNumber: shirtNumber,\r\n        observations: formData.get(\"observations\"),\r\n        registrationDate: formData.get(\"registrationDate\"),\r\n        withdrawalDate: formData.get(\"withdrawalDate\"),\r\n        status: formData.get(\"status\") || \"ACTIVO\",\r\n        siblings: formData.get(\"siblings\"),\r\n        category: formData.get(\"category\"),\r\n        federationYear: formData.get(\"federationYear\"),\r\n        federationInstallments: formData.get(\"federationInstallments\"),\r\n    };\r\n\r\n    // Manual date parsing check to avoid crash\r\n    const parseDate = (d: any) => {\r\n        if (!d) return null;\r\n        const date = new Date(d);\r\n        return isNaN(date.getTime()) ? null : date;\r\n    };\r\n\r\n    // Shirt Number Validation\r\n    if (shirtNumber !== null) {\r\n        if (shirtNumber < 0 || shirtNumber > 99) {\r\n            return { message: \"El número de camiseta debe estar entre 0 y 99.\", errors: { shirtNumber: [\"Rango inválido\"] } };\r\n        }\r\n        const shirtError = await validateShirtNumber(id, shirtNumber, rawData.tira as string, rawData.birthDate as string, rawData.category as string);\r\n        if (shirtError) return { message: shirtError, errors: { shirtNumber: [shirtError] } };\r\n    }\r\n\r\n    try {\r\n        const playerName = `${(rawData.lastName as string).toUpperCase()}, ${(rawData.firstName as string).toUpperCase()}`;\r\n\r\n        // 1. Update the Current Player\r\n        const player = await prisma.player.update({\r\n            where: { id },\r\n            data: {\r\n                firstName: (rawData.firstName as string).toUpperCase(),\r\n                lastName: (rawData.lastName as string).toUpperCase(),\r\n                dni: rawData.dni as string,\r\n                birthDate: new Date(rawData.birthDate as string),\r\n                tira: rawData.tira as string,\r\n                scholarship: scholarship,\r\n                federated: federated,\r\n                playsPrimera: playsPrimera,\r\n                email: (rawData.email as string) || null,\r\n                phone: (rawData.phone as string) || null,\r\n                partnerNumber: (rawData.partnerNumber as string) || null,\r\n                contactName: rawData.contactName ? (rawData.contactName as string).toUpperCase() : null,\r\n                shirtNumber: shirtNumber,\r\n                observations: rawData.observations ? (rawData.observations as string).toUpperCase() : null,\r\n                registrationDate: parseDate(rawData.registrationDate),\r\n                withdrawalDate: parseDate(rawData.withdrawalDate),\r\n                siblings: rawData.siblings ? (rawData.siblings as string).toUpperCase() : null,\r\n                category: (rawData.category as string) || null,\r\n                status: evaluatePlayerStatus(rawData.status as string, rawData.dni as string, rawData.birthDate as string),\r\n                federationYear: rawData.federationYear ? parseInt(rawData.federationYear as string) : null,\r\n                federationInstallments: (rawData.federationInstallments as string) || null,\r\n            } as any\r\n        });\r\n\r\n        // 2. Bidirectional siblings Sync\r\n        // We have siblingIds from the form, which contains IDs of ALL currently selected siblings.\r\n        const siblingIdsStr = formData.get(\"siblingIds\")?.toString();\r\n        const currentSiblingIds = siblingIdsStr ? siblingIdsStr.split(',').filter(Boolean) : [];\r\n\r\n        // Update ALL referenced siblings to ensure they have THIS player in their list\r\n        for (const sId of currentSiblingIds) {\r\n            const sPlayer = await prisma.player.findUnique({ where: { id: sId } }) as any;\r\n            if (sPlayer) {\r\n                const sSiblings = sPlayer.siblings ? sPlayer.siblings.split(';').map((s: string) => s.trim()) : [];\r\n                // Check if I am in their list\r\n                if (!sSiblings.includes(playerName)) {\r\n                    sSiblings.push(playerName);\r\n                    await prisma.player.update({\r\n                        where: { id: sId },\r\n                        data: { siblings: sSiblings.join('; ') }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Note: Removing reference from others when I remove them from my list is harder with just string names storage\r\n        // and without knowing who was there before. We will focus on the \"Adding\" requirement for now.\r\n\r\n        await createAuditLog(\"UPDATE\", \"Player\", id, rawData);\r\n    } catch (error: any) {\r\n        console.error(\"Update Player Error:\", error);\r\n        return { message: \"Error al actualizar: \" + error.message, errors: undefined };\r\n    }\r\n\r\n    revalidatePath(\"/dashboard/players\");\r\n\r\n    // Get return filters to preserve them\r\n    const returnFilters = formData.get(\"returnFilters\")?.toString();\r\n    const redirectUrl = returnFilters ? `/dashboard/players?${returnFilters}` : '/dashboard/players';\r\n    redirect(redirectUrl);\r\n}\r\n\r\nexport async function searchPlayers(query: string) {\r\n    const session = await auth();\r\n    if (!session) return [];\r\n\r\n    if (!query || query.length < 2) return [];\r\n\r\n    return await prisma.player.findMany({\r\n        where: {\r\n            OR: [\r\n                { firstName: { contains: query } },\r\n                { lastName: { contains: query } },\r\n                { dni: { contains: query } },\r\n            ],\r\n            status: \"ACTIVO\"\r\n        },\r\n        select: {\r\n            id: true,\r\n            firstName: true,\r\n            lastName: true,\r\n            dni: true,\r\n        },\r\n        take: 10,\r\n        orderBy: [{ lastName: 'asc' }, { firstName: 'asc' }]\r\n    });\r\n}\r\n\r\nexport async function getPlayersByNames(names: string[]) {\r\n    const session = await auth();\r\n    if (!session || !names.length) return [];\r\n\r\n    // Names are \"LAST, FIRST\"\r\n    // We can't easy do a \"IN\" query because split.\r\n    // We will fetch by \"OR\".\r\n    const criteria = names.map(n => {\r\n        const [last, first] = n.split(',').map(s => s.trim());\r\n        if (last && first) return { lastName: last, firstName: first };\r\n        return null;\r\n    }).filter(Boolean) as { lastName: string, firstName: string }[];\r\n\r\n    if (criteria.length === 0) return [];\r\n\r\n    return await prisma.player.findMany({\r\n        where: {\r\n            OR: criteria\r\n        },\r\n        select: {\r\n            id: true,\r\n            firstName: true,\r\n            lastName: true,\r\n            dni: true\r\n        }\r\n    });\r\n}\r\n\r\nexport async function deleteAllPlayers() {\r\n    const session = await auth();\r\n    if (session?.user?.role !== 'ADMIN') return { message: \"Unauthorized\" };\r\n\r\n    try {\r\n        // Delete related attendance records first due to foreign key constraints if any\r\n        await (prisma as any).attendance.deleteMany({});\r\n        await prisma.player.deleteMany({});\r\n\r\n        await createAuditLog(\"DELETE_ALL\", \"Player\", \"ALL\", { count: \"ALL\" });\r\n\r\n        revalidatePath(\"/dashboard/players\");\r\n        return { message: \"Todos los jugadores han sido eliminados correctamente.\" };\r\n    } catch (error: any) {\r\n        console.error(\"Delete All Players Error:\", error);\r\n        return { message: \"Error al eliminar jugadores: \" + error.message };\r\n    }\r\n}\r\n\r\n\r\nexport async function dismissAuditIssue(ruleId: string, identifier: string) {\r\n    const session = await auth();\r\n    if (!session) return { message: \"Unauthorized\" };\r\n\r\n    try {\r\n        await prisma.dismissedAuditIssue.create({\r\n            data: {\r\n                ruleId,\r\n                identifier,\r\n                reason: \"Dismissed by user\"\r\n            }\r\n        });\r\n        revalidatePath(\"/dashboard/administracion/audit\");\r\n        return { message: \"Issue dismissed\" };\r\n    } catch (error: any) {\r\n        return { message: \"Error dismissing issue: \" + error.message };\r\n    }\r\n}\r\nexport async function deletePlayer(id: string, returnFilters?: string) {\r\n    const session = await auth();\r\n    const role = (session?.user as any)?.role || 'VIEWER';\r\n    if (role !== 'ADMIN' && role !== 'OPERADOR') return { message: \"No autorizado\" };\r\n\r\n    try {\r\n        // Delete related records\r\n        await (prisma as any).attendance.deleteMany({ where: { playerId: id } });\r\n        await (prisma as any).payment.deleteMany({ where: { playerId: id } });\r\n\r\n        const player = await prisma.player.delete({ where: { id } });\r\n\r\n        await createAuditLog(\"DELETE\", \"Player\", id, { name: `${player.lastName}, ${player.firstName}` });\r\n\r\n        revalidatePath(\"/dashboard/players\");\r\n\r\n        // Preserve filters on redirect\r\n        const redirectUrl = returnFilters ? `/dashboard/players?${returnFilters}` : '/dashboard/players';\r\n        redirect(redirectUrl);\r\n    } catch (error: any) {\r\n        if (error.message === 'NEXT_REDIRECT') throw error;\r\n        console.error(\"Delete Player Error:\", error);\r\n        return { message: \"Error al eliminar jugador: \" + error.message };\r\n    }\r\n}\r\n\r\nasync function validateShirtNumber(playerId: string | null, shirtNumber: number, tira: string, birthDate: string, manualCategory?: string) {\r\n    const { getCategory } = await import(\"@/lib/utils\");\r\n\r\n    // 1. Get all category mappings and sort by minYear (youngest to oldest)\r\n    const mappings = await (prisma as any).categoryMapping.findMany({ orderBy: { minYear: 'desc' } });\r\n\r\n    // 2. Identify the player's category\r\n    const currentCategory = getCategory({ birthDate, category: manualCategory }, mappings);\r\n\r\n    // 3. Find adjacent categories\r\n    // mappings are already sorted by minYear desc (youngest to oldest)\r\n    // Actually minYear: desc means 2018, 2016, 2014... (youngest first)\r\n    // Let's reverse find index\r\n    const sortedCats = mappings.map((m: any) => m.category);\r\n    const currIdx = sortedCats.indexOf(currentCategory);\r\n\r\n    const targetCategories = [currentCategory];\r\n    if (currIdx > 0) targetCategories.push(sortedCats[currIdx - 1]); // younger\r\n    if (currIdx !== -1 && currIdx < sortedCats.length - 1) targetCategories.push(sortedCats[currIdx + 1]); // older\r\n\r\n    // 4. Check for conflicts\r\n    const conflict = await prisma.player.findFirst({\r\n        where: {\r\n            id: { not: playerId || undefined },\r\n            tira: tira,\r\n            shirtNumber: shirtNumber,\r\n            OR: [\r\n                { category: { in: targetCategories } }, // Manual match\r\n                { category: null } // Need to check if their dynamic category matches any target\r\n            ]\r\n        }\r\n    });\r\n\r\n    if (conflict) {\r\n        // If conflict.category is null, we must calculate its dynamic category\r\n        if (!conflict.category) {\r\n            const dynamicCat = getCategory(conflict, mappings);\r\n            if (!targetCategories.includes(dynamicCat)) return null;\r\n        }\r\n        return `El número #${shirtNumber} ya está en uso en ${tira} para la categoría ${currentCategory} o adyacentes.`;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;AAGA,MAAM,aAAa,kLAAC,CAAC,MAAM,CAAC;IACxB,WAAW,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC7B,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,KAAK,kLAAC,CAAC,MAAM,GACR,GAAG,CAAC,GAAG,sBACP,MAAM,CACH,CAAC,MAAQ,aAAa,IAAI,CAAC,QAAQ,SAAS,IAAI,CAAC,MACjD;IAER,WAAW,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC7B,MAAM,kLAAC,CAAC,MAAM;IACd,aAAa,kLAAC,CAAC,OAAO,GAAG,QAAQ;IACjC,cAAc,kLAAC,CAAC,OAAO,GAAG,QAAQ;IAClC,OAAO,kLAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ,GAAG,EAAE,CAAC,kLAAC,CAAC,OAAO,CAAC;IAClD,OAAO,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAC/B,CAAC,MAAQ,CAAC,OAAO,WAAW,IAAI,CAAC,MACjC;IAEJ,eAAe,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAClC,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,aAAa,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,QAAQ;IACvC,cAAc,kLAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,kBAAkB,kLAAC,CAAC,MAAM,GAAG,QAAQ;IACrC,gBAAgB,kLAAC,CAAC,MAAM,GAAG,QAAQ;IACnC,QAAQ,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAU;QAAY;KAAU,EAAE,OAAO,CAAC;IAC1D,UAAU,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,UAAU,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,gBAAgB,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,QAAQ;IAC1C,wBAAwB,kLAAC,CAAC,MAAM,GAAG,QAAQ;AAC/C;AAEA,SAAS,YAAY,GAAQ;IACzB,IAAI,CAAC,KAAK,OAAO,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI;IACrC,MAAM,MAAM,OAAO;IACnB,uCAAuC;IACvC,IAAI,IAAI,UAAU,CAAC,UAAU,OAAO;IACpC,MAAM,YAAY,IAAI,OAAO,CAAC,OAAO;IACrC,OAAO,UAAU,MAAM,GAAG,IAAI,YAAY,CAAC,KAAK,EAAE,KAAK,GAAG,IAAI;AAClE;AAEO,eAAe,eAAe,MAAc,EAAE,MAAc,EAAE,QAAgB,EAAE,OAAa;IAChG,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,MAAM,SAAS,SAAS,MAAM;IAE9B,IAAI,QAAQ;QACR,iFAAiF;QACjF,MAAM,aAAa,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI;YAAO;QAAE;QAExE,MAAM,8HAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YACzB,MAAM;gBACF;gBACA;gBACA;gBACA,SAAS,UAAU,KAAK,SAAS,CAAC,WAAW;gBAC7C,QAAQ,aAAa,SAAS;YAClC;QACJ;IACJ;AACJ;AAEO,eAAe,aAAa,SAAc,EAAE,QAAkB;IACjE,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,MAAM,OAAO,AAAC,SAAS,MAAc,QAAQ;IAC7C,IAAI,CAAC,WAAY,SAAS,WAAW,SAAS,YAAa;QACvD,OAAO;YAAE,SAAS;YAA+C,QAAQ;QAAU;IACvF;IAEA,MAAM,cAAc,SAAS,GAAG,CAAC,mBAAmB;IACpD,MAAM,YAAY,SAAS,GAAG,CAAC,iBAAiB;IAChD,MAAM,eAAe,SAAS,GAAG,CAAC,oBAAoB;IACtD,MAAM,iBAAiB,SAAS,GAAG,CAAC;IACpC,MAAM,cAAc,AAAC,kBAAkB,mBAAmB,KAAM,SAAS,eAAe,QAAQ,MAAM;IAEtG,MAAM,UAAU;QACZ,WAAW,SAAS,GAAG,CAAC;QACxB,UAAU,SAAS,GAAG,CAAC;QACvB,KAAK,YAAY,SAAS,GAAG,CAAC;QAC9B,WAAW,SAAS,GAAG,CAAC;QACxB,MAAM,SAAS,GAAG,CAAC;QACnB,aAAa;QACb,WAAW;QACX,cAAc;QACd,OAAO,SAAS,GAAG,CAAC;QACpB,OAAO,SAAS,GAAG,CAAC;QACpB,SAAS;QACT,eAAe,SAAS,GAAG,CAAC;QAC5B,aAAa,SAAS,GAAG,CAAC;QAC1B,aAAa;QACb,cAAc,SAAS,GAAG,CAAC;QAC3B,kBAAkB,SAAS,GAAG,CAAC;QAC/B,QAAQ,SAAS,GAAG,CAAC,aAAa;QAClC,UAAU,SAAS,GAAG,CAAC;QACvB,UAAU,SAAS,GAAG,CAAC;QACvB,gBAAgB,SAAS,GAAG,CAAC;QAC7B,wBAAwB,SAAS,GAAG,CAAC;IACzC;IAEA,MAAM,kBAAkB,WAAW,SAAS,CAAC;IAE7C,IAAI,CAAC,gBAAgB,OAAO,EAAE;QAC1B,QAAQ,GAAG,CAAC,gBAAgB,KAAK,CAAC,OAAO;QACzC,OAAO;YACH,QAAQ,gBAAgB,KAAK,CAAC,OAAO,GAAG,WAAW;YACnD,SAAS;QACb;IACJ;IAEA,MAAM,OAAO,gBAAgB,IAAI;IAEjC,gEAAgE;IAChE,IAAI,gBAAgB,MAAM;QACtB,IAAI,cAAc,KAAK,cAAc,IAAI;YACrC,OAAO;gBAAE,SAAS;gBAAkD,QAAQ;oBAAE,aAAa;wBAAC;qBAAiB;gBAAC;YAAE;QACpH;QACA,MAAM,aAAa,MAAM,oBAAoB,MAAM,aAAa,KAAK,IAAI,EAAE,KAAK,SAAS,EAAE,KAAK,QAAQ;QACxG,IAAI,YAAY,OAAO;YAAE,SAAS;YAAY,QAAQ;gBAAE,aAAa;oBAAC;iBAAW;YAAC;QAAE;IACxF;IAEA,IAAI;QACA,MAAM,aAAa,GAAG,KAAK,QAAQ,CAAC,WAAW,GAAG,EAAE,EAAE,KAAK,SAAS,CAAC,WAAW,IAAI;QACpF,MAAM,SAAS,MAAM,8HAAM,CAAC,MAAM,CAAC,MAAM,CAAC;YACtC,MAAM;gBACF,WAAW,KAAK,SAAS,CAAC,WAAW;gBACrC,UAAU,KAAK,QAAQ,CAAC,WAAW;gBACnC,KAAK,KAAK,GAAG;gBACb,WAAW,IAAI,KAAK,KAAK,SAAS;gBAClC,MAAM,KAAK,IAAI;gBACf,aAAa;gBACb,WAAW;gBACX,cAAc;gBACd,OAAO,KAAK,KAAK,IAAI;gBACrB,OAAO,KAAK,KAAK,IAAI;gBACrB,eAAe,KAAK,aAAa,IAAI;gBACrC,aAAa,KAAK,WAAW,GAAG,KAAK,WAAW,CAAC,WAAW,KAAK;gBACjE,aAAa,KAAK,WAAW,IAAI;gBACjC,cAAc,KAAK,YAAY,GAAG,KAAK,YAAY,CAAC,WAAW,KAAK;gBACpE,kBAAkB,KAAK,gBAAgB,GAAG,IAAI,KAAK,KAAK,gBAAgB,IAAI;gBAC5E,UAAU,KAAK,QAAQ,GAAG,KAAK,QAAQ,CAAC,WAAW,KAAK;gBACxD,UAAU,KAAK,QAAQ,IAAI;gBAC3B,QAAQ,IAAA,2IAAoB,EAAC,KAAK,MAAM,EAAE,KAAK,GAAG,EAAE,KAAK,SAAS;gBAClE,gBAAgB,KAAK,cAAc,IAAI;gBACvC,wBAAwB,KAAK,sBAAsB,IAAI;YAC3D;QACJ;QAEA,gFAAgF;QAChF,MAAM,aAAa,SAAS,GAAG,CAAC,eAAe;QAC/C,IAAI,YAAY;YACZ,MAAM,MAAM,WAAW,KAAK,CAAC,KAAK,MAAM,CAAC;YACzC,KAAK,MAAM,OAAO,IAAK;gBACnB,MAAM,UAAU,MAAM,8HAAM,CAAC,MAAM,CAAC,UAAU,CAAC;oBAAE,OAAO;wBAAE,IAAI;oBAAI;gBAAE;gBACpE,IAAI,SAAS;oBACT,MAAM,kBAAkB,QAAQ,QAAQ,GAAG,QAAQ,QAAQ,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAc,EAAE,IAAI,MAAM,EAAE;oBACxG,IAAI,CAAC,gBAAgB,QAAQ,CAAC,aAAa;wBACvC,gBAAgB,IAAI,CAAC;wBACrB,MAAM,8HAAM,CAAC,MAAM,CAAC,MAAM,CAAC;4BACvB,OAAO;gCAAE,IAAI;4BAAI;4BACjB,MAAM;gCAAE,UAAU,gBAAgB,IAAI,CAAC;4BAAM;wBACjD;oBACJ;gBACJ;YACJ;QACJ;QAEA,MAAM,eAAe,UAAU,UAAU,OAAO,EAAE,EAAE;IACxD,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,IAAI,MAAM,IAAI,KAAK,SAAS,OAAO;YAAE,SAAS;QAAoB;QAClE,OAAO;YAAE,SAAS,6BAA6B,MAAM,OAAO;QAAC;IACjE;IAEA,IAAA,+IAAc,EAAC;IACf,IAAA,iMAAQ,EAAC;AACb;AAOO,eAAe,aAAa,EAAU,EAAE,SAAsB,EAAE,QAAkB;IACrF,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,MAAM,OAAO,AAAC,SAAS,MAAc,QAAQ;IAC7C,IAAI,CAAC,WAAY,SAAS,WAAW,SAAS,YAAa;QACvD,OAAO;YAAE,SAAS;YAA+C,QAAQ;QAAU;IACvF;IAEA,MAAM,cAAc,SAAS,GAAG,CAAC,mBAAmB;IACpD,MAAM,YAAY,SAAS,GAAG,CAAC,iBAAiB;IAChD,MAAM,eAAe,SAAS,GAAG,CAAC,oBAAoB;IACtD,MAAM,iBAAiB,SAAS,GAAG,CAAC;IACpC,MAAM,cAAc,AAAC,kBAAkB,mBAAmB,KAAM,SAAS,eAAe,QAAQ,MAAM;IAEtG,MAAM,UAAU;QACZ,WAAW,SAAS,GAAG,CAAC;QACxB,UAAU,SAAS,GAAG,CAAC;QACvB,KAAK,YAAY,SAAS,GAAG,CAAC;QAC9B,WAAW,SAAS,GAAG,CAAC;QACxB,MAAM,SAAS,GAAG,CAAC;QACnB,aAAa;QACb,WAAW;QACX,cAAc;QACd,OAAO,SAAS,GAAG,CAAC;QACpB,OAAO,SAAS,GAAG,CAAC;QACpB,eAAe,SAAS,GAAG,CAAC;QAC5B,aAAa,SAAS,GAAG,CAAC;QAC1B,aAAa;QACb,cAAc,SAAS,GAAG,CAAC;QAC3B,kBAAkB,SAAS,GAAG,CAAC;QAC/B,gBAAgB,SAAS,GAAG,CAAC;QAC7B,QAAQ,SAAS,GAAG,CAAC,aAAa;QAClC,UAAU,SAAS,GAAG,CAAC;QACvB,UAAU,SAAS,GAAG,CAAC;QACvB,gBAAgB,SAAS,GAAG,CAAC;QAC7B,wBAAwB,SAAS,GAAG,CAAC;IACzC;IAEA,2CAA2C;IAC3C,MAAM,YAAY,CAAC;QACf,IAAI,CAAC,GAAG,OAAO;QACf,MAAM,OAAO,IAAI,KAAK;QACtB,OAAO,MAAM,KAAK,OAAO,MAAM,OAAO;IAC1C;IAEA,0BAA0B;IAC1B,IAAI,gBAAgB,MAAM;QACtB,IAAI,cAAc,KAAK,cAAc,IAAI;YACrC,OAAO;gBAAE,SAAS;gBAAkD,QAAQ;oBAAE,aAAa;wBAAC;qBAAiB;gBAAC;YAAE;QACpH;QACA,MAAM,aAAa,MAAM,oBAAoB,IAAI,aAAa,QAAQ,IAAI,EAAY,QAAQ,SAAS,EAAY,QAAQ,QAAQ;QACnI,IAAI,YAAY,OAAO;YAAE,SAAS;YAAY,QAAQ;gBAAE,aAAa;oBAAC;iBAAW;YAAC;QAAE;IACxF;IAEA,IAAI;QACA,MAAM,aAAa,GAAG,AAAC,QAAQ,QAAQ,CAAY,WAAW,GAAG,EAAE,EAAE,AAAC,QAAQ,SAAS,CAAY,WAAW,IAAI;QAElH,+BAA+B;QAC/B,MAAM,SAAS,MAAM,8HAAM,CAAC,MAAM,CAAC,MAAM,CAAC;YACtC,OAAO;gBAAE;YAAG;YACZ,MAAM;gBACF,WAAW,AAAC,QAAQ,SAAS,CAAY,WAAW;gBACpD,UAAU,AAAC,QAAQ,QAAQ,CAAY,WAAW;gBAClD,KAAK,QAAQ,GAAG;gBAChB,WAAW,IAAI,KAAK,QAAQ,SAAS;gBACrC,MAAM,QAAQ,IAAI;gBAClB,aAAa;gBACb,WAAW;gBACX,cAAc;gBACd,OAAO,AAAC,QAAQ,KAAK,IAAe;gBACpC,OAAO,AAAC,QAAQ,KAAK,IAAe;gBACpC,eAAe,AAAC,QAAQ,aAAa,IAAe;gBACpD,aAAa,QAAQ,WAAW,GAAG,AAAC,QAAQ,WAAW,CAAY,WAAW,KAAK;gBACnF,aAAa;gBACb,cAAc,QAAQ,YAAY,GAAG,AAAC,QAAQ,YAAY,CAAY,WAAW,KAAK;gBACtF,kBAAkB,UAAU,QAAQ,gBAAgB;gBACpD,gBAAgB,UAAU,QAAQ,cAAc;gBAChD,UAAU,QAAQ,QAAQ,GAAG,AAAC,QAAQ,QAAQ,CAAY,WAAW,KAAK;gBAC1E,UAAU,AAAC,QAAQ,QAAQ,IAAe;gBAC1C,QAAQ,IAAA,2IAAoB,EAAC,QAAQ,MAAM,EAAY,QAAQ,GAAG,EAAY,QAAQ,SAAS;gBAC/F,gBAAgB,QAAQ,cAAc,GAAG,SAAS,QAAQ,cAAc,IAAc;gBACtF,wBAAwB,AAAC,QAAQ,sBAAsB,IAAe;YAC1E;QACJ;QAEA,iCAAiC;QACjC,2FAA2F;QAC3F,MAAM,gBAAgB,SAAS,GAAG,CAAC,eAAe;QAClD,MAAM,oBAAoB,gBAAgB,cAAc,KAAK,CAAC,KAAK,MAAM,CAAC,WAAW,EAAE;QAEvF,+EAA+E;QAC/E,KAAK,MAAM,OAAO,kBAAmB;YACjC,MAAM,UAAU,MAAM,8HAAM,CAAC,MAAM,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE,IAAI;gBAAI;YAAE;YACpE,IAAI,SAAS;gBACT,MAAM,YAAY,QAAQ,QAAQ,GAAG,QAAQ,QAAQ,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAc,EAAE,IAAI,MAAM,EAAE;gBAClG,8BAA8B;gBAC9B,IAAI,CAAC,UAAU,QAAQ,CAAC,aAAa;oBACjC,UAAU,IAAI,CAAC;oBACf,MAAM,8HAAM,CAAC,MAAM,CAAC,MAAM,CAAC;wBACvB,OAAO;4BAAE,IAAI;wBAAI;wBACjB,MAAM;4BAAE,UAAU,UAAU,IAAI,CAAC;wBAAM;oBAC3C;gBACJ;YACJ;QACJ;QAEA,gHAAgH;QAChH,+FAA+F;QAE/F,MAAM,eAAe,UAAU,UAAU,IAAI;IACjD,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,SAAS,0BAA0B,MAAM,OAAO;YAAE,QAAQ;QAAU;IACjF;IAEA,IAAA,+IAAc,EAAC;IAEf,sCAAsC;IACtC,MAAM,gBAAgB,SAAS,GAAG,CAAC,kBAAkB;IACrD,MAAM,cAAc,gBAAgB,CAAC,mBAAmB,EAAE,eAAe,GAAG;IAC5E,IAAA,iMAAQ,EAAC;AACb;AAEO,eAAe,cAAc,KAAa;IAC7C,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,IAAI,CAAC,SAAS,OAAO,EAAE;IAEvB,IAAI,CAAC,SAAS,MAAM,MAAM,GAAG,GAAG,OAAO,EAAE;IAEzC,OAAO,MAAM,8HAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;QAChC,OAAO;YACH,IAAI;gBACA;oBAAE,WAAW;wBAAE,UAAU;oBAAM;gBAAE;gBACjC;oBAAE,UAAU;wBAAE,UAAU;oBAAM;gBAAE;gBAChC;oBAAE,KAAK;wBAAE,UAAU;oBAAM;gBAAE;aAC9B;YACD,QAAQ;QACZ;QACA,QAAQ;YACJ,IAAI;YACJ,WAAW;YACX,UAAU;YACV,KAAK;QACT;QACA,MAAM;QACN,SAAS;YAAC;gBAAE,UAAU;YAAM;YAAG;gBAAE,WAAW;YAAM;SAAE;IACxD;AACJ;AAEO,eAAe,kBAAkB,KAAe;IACnD,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,IAAI,CAAC,WAAW,CAAC,MAAM,MAAM,EAAE,OAAO,EAAE;IAExC,0BAA0B;IAC1B,+CAA+C;IAC/C,yBAAyB;IACzB,MAAM,WAAW,MAAM,GAAG,CAAC,CAAA;QACvB,MAAM,CAAC,MAAM,MAAM,GAAG,EAAE,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;QAClD,IAAI,QAAQ,OAAO,OAAO;YAAE,UAAU;YAAM,WAAW;QAAM;QAC7D,OAAO;IACX,GAAG,MAAM,CAAC;IAEV,IAAI,SAAS,MAAM,KAAK,GAAG,OAAO,EAAE;IAEpC,OAAO,MAAM,8HAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;QAChC,OAAO;YACH,IAAI;QACR;QACA,QAAQ;YACJ,IAAI;YACJ,WAAW;YACX,UAAU;YACV,KAAK;QACT;IACJ;AACJ;AAEO,eAAe;IAClB,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,IAAI,SAAS,MAAM,SAAS,SAAS,OAAO;QAAE,SAAS;IAAe;IAEtE,IAAI;QACA,gFAAgF;QAChF,MAAM,AAAC,8HAAM,CAAS,UAAU,CAAC,UAAU,CAAC,CAAC;QAC7C,MAAM,8HAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAEhC,MAAM,eAAe,cAAc,UAAU,OAAO;YAAE,OAAO;QAAM;QAEnE,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAyD;IAC/E,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;YAAE,SAAS,kCAAkC,MAAM,OAAO;QAAC;IACtE;AACJ;AAGO,eAAe,kBAAkB,MAAc,EAAE,UAAkB;IACtE,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,IAAI,CAAC,SAAS,OAAO;QAAE,SAAS;IAAe;IAE/C,IAAI;QACA,MAAM,8HAAM,CAAC,mBAAmB,CAAC,MAAM,CAAC;YACpC,MAAM;gBACF;gBACA;gBACA,QAAQ;YACZ;QACJ;QACA,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAkB;IACxC,EAAE,OAAO,OAAY;QACjB,OAAO;YAAE,SAAS,6BAA6B,MAAM,OAAO;QAAC;IACjE;AACJ;AACO,eAAe,aAAa,EAAU,EAAE,aAAsB;IACjE,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,MAAM,OAAO,AAAC,SAAS,MAAc,QAAQ;IAC7C,IAAI,SAAS,WAAW,SAAS,YAAY,OAAO;QAAE,SAAS;IAAgB;IAE/E,IAAI;QACA,yBAAyB;QACzB,MAAM,AAAC,8HAAM,CAAS,UAAU,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,UAAU;YAAG;QAAE;QACtE,MAAM,AAAC,8HAAM,CAAS,OAAO,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,UAAU;YAAG;QAAE;QAEnE,MAAM,SAAS,MAAM,8HAAM,CAAC,MAAM,CAAC,MAAM,CAAC;YAAE,OAAO;gBAAE;YAAG;QAAE;QAE1D,MAAM,eAAe,UAAU,UAAU,IAAI;YAAE,MAAM,GAAG,OAAO,QAAQ,CAAC,EAAE,EAAE,OAAO,SAAS,EAAE;QAAC;QAE/F,IAAA,+IAAc,EAAC;QAEf,+BAA+B;QAC/B,MAAM,cAAc,gBAAgB,CAAC,mBAAmB,EAAE,eAAe,GAAG;QAC5E,IAAA,iMAAQ,EAAC;IACb,EAAE,OAAO,OAAY;QACjB,IAAI,MAAM,OAAO,KAAK,iBAAiB,MAAM;QAC7C,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,SAAS,gCAAgC,MAAM,OAAO;QAAC;IACpE;AACJ;AAEA,eAAe,oBAAoB,QAAuB,EAAE,WAAmB,EAAE,IAAY,EAAE,SAAiB,EAAE,cAAuB;IACrI,MAAM,EAAE,WAAW,EAAE,GAAG;IAExB,wEAAwE;IACxE,MAAM,WAAW,MAAM,AAAC,8HAAM,CAAS,eAAe,CAAC,QAAQ,CAAC;QAAE,SAAS;YAAE,SAAS;QAAO;IAAE;IAE/F,oCAAoC;IACpC,MAAM,kBAAkB,YAAY;QAAE;QAAW,UAAU;IAAe,GAAG;IAE7E,8BAA8B;IAC9B,mEAAmE;IACnE,oEAAoE;IACpE,2BAA2B;IAC3B,MAAM,aAAa,SAAS,GAAG,CAAC,CAAC,IAAW,EAAE,QAAQ;IACtD,MAAM,UAAU,WAAW,OAAO,CAAC;IAEnC,MAAM,mBAAmB;QAAC;KAAgB;IAC1C,IAAI,UAAU,GAAG,iBAAiB,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,GAAG,UAAU;IAC3E,IAAI,YAAY,CAAC,KAAK,UAAU,WAAW,MAAM,GAAG,GAAG,iBAAiB,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,GAAG,QAAQ;IAE/G,yBAAyB;IACzB,MAAM,WAAW,MAAM,8HAAM,CAAC,MAAM,CAAC,SAAS,CAAC;QAC3C,OAAO;YACH,IAAI;gBAAE,KAAK,YAAY;YAAU;YACjC,MAAM;YACN,aAAa;YACb,IAAI;gBACA;oBAAE,UAAU;wBAAE,IAAI;oBAAiB;gBAAE;gBACrC;oBAAE,UAAU;gBAAK,EAAE,6DAA6D;aACnF;QACL;IACJ;IAEA,IAAI,UAAU;QACV,uEAAuE;QACvE,IAAI,CAAC,SAAS,QAAQ,EAAE;YACpB,MAAM,aAAa,YAAY,UAAU;YACzC,IAAI,CAAC,iBAAiB,QAAQ,CAAC,aAAa,OAAO;QACvD;QACA,OAAO,CAAC,WAAW,EAAE,YAAY,mBAAmB,EAAE,KAAK,mBAAmB,EAAE,gBAAgB,cAAc,CAAC;IACnH;IAEA,OAAO;AACX;;;IAvasB;IAoBA;IAwHA;IA0HA;IA0BA;IA4BA;IAoBA;IAkBA;;AAlWA,+OAAA;AAoBA,+OAAA;AAwHA,+OAAA;AA0HA,+OAAA;AA0BA,+OAAA;AA4BA,+OAAA;AAoBA,+OAAA;AAkBA,+OAAA"}},
    {"offset": {"line": 671, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/src/lib/payment-actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { auth } from \"@/auth\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { createAuditLog } from \"./actions\";\r\nimport * as XLSX from 'xlsx';\r\n\r\nexport type PaymentStatus = {\r\n    social: string;\r\n    activity: string;\r\n    socialDate?: string;\r\n    activityDate?: string;\r\n};\r\n\r\nexport type PlayerMatchResult = {\r\n    originalData: any;\r\n    status: 'MATCHED' | 'UNMATCHED';\r\n    matchMethod?: 'DNI' | 'PARTNER_NUMBER' | 'NAME_FUZZY';\r\n    player?: {\r\n        id: string;\r\n        name: string;\r\n        dni: string;\r\n        category: string;\r\n        tira: string;\r\n    };\r\n    paymentStatus?: PaymentStatus;\r\n    notes?: string[];\r\n};\r\n\r\nexport type ImportResult = {\r\n    success: boolean;\r\n    message?: string;\r\n    stats: {\r\n        total: number;\r\n        matched: number;\r\n        unmatched: number;\r\n    };\r\n    results: PlayerMatchResult[];\r\n    logs: string[];\r\n};\r\n\r\nexport type FederationPaymentData = {\r\n    year: number;\r\n    installments: string;\r\n};\r\n\r\nexport type FederationMatchResult = {\r\n    originalData: any;\r\n    status: 'MATCHED' | 'UNMATCHED';\r\n    matchMethod?: 'DNI' | 'NAME_FUZZY';\r\n    player?: {\r\n        id: string;\r\n        name: string;\r\n        dni: string;\r\n        category: string;\r\n        tira: string;\r\n        playerStatus: string;\r\n    };\r\n    federationData?: FederationPaymentData;\r\n    notes?: string[];\r\n};\r\n\r\nexport type FederationImportResult = {\r\n    success: boolean;\r\n    message?: string;\r\n    stats: {\r\n        total: number;\r\n        matched: number;\r\n        unmatched: number;\r\n    };\r\n    results: FederationMatchResult[];\r\n    logs: string[];\r\n};\r\n\r\nfunction normalizeString(str: string): string {\r\n    return str ? str.trim().toUpperCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\") : \"\";\r\n}\r\n\r\n/**\r\n * Finds a column key in a row using flexible matching:\r\n * - Exact match (case-insensitive, normalized whitespace)\r\n * - Partial match (key contains the candidate)\r\n */\r\nfunction findColumn(row: any, candidates: string[]): string | undefined {\r\n    const rowKeys = Object.keys(row);\r\n    // Pass 1: exact match after normalizing whitespace\r\n    for (const candidate of candidates) {\r\n        const nc = candidate.trim().toLowerCase().replace(/\\s+/g, ' ');\r\n        const found = rowKeys.find(k => k.trim().toLowerCase().replace(/[\\r\\n\\s]+/g, ' ') === nc);\r\n        if (found) return found;\r\n    }\r\n    // Pass 2: partial includes\r\n    for (const candidate of candidates) {\r\n        const nc = candidate.trim().toLowerCase();\r\n        const found = rowKeys.find(k => k.toLowerCase().replace(/[\\r\\n]+/g, ' ').trim().includes(nc));\r\n        if (found) return found;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n// ─── CUOTA SOCIAL / ACTIVIDAD ────────────────────────────────────────────────\r\n\r\nexport async function processPaymentExcel(prevState: any, formData: FormData): Promise<ImportResult> {\r\n    const session = await auth();\r\n    if (!session) {\r\n        return { success: false, message: \"No autorizado\", stats: { total: 0, matched: 0, unmatched: 0 }, results: [], logs: [\"Error: Usuario no autenticado\"] };\r\n    }\r\n\r\n    const file = formData.get('file') as File;\r\n    if (!file) {\r\n        return { success: false, message: \"No se seleccionó archivo\", stats: { total: 0, matched: 0, unmatched: 0 }, results: [], logs: [\"Error: Sin archivo\"] };\r\n    }\r\n\r\n    const logs: string[] = [];\r\n    logs.push(`Inicio de procesamiento: ${new Date().toLocaleString()}`);\r\n\r\n    try {\r\n        const arrayBuffer = await file.arrayBuffer();\r\n        const buffer = Buffer.from(arrayBuffer);\r\n        const workbook = XLSX.read(buffer, { type: 'buffer' });\r\n\r\n        const sheetName = workbook.SheetNames.find(s => s.toLowerCase().includes('basquet')) || workbook.SheetNames[0];\r\n        logs.push(`Leyendo hoja: ${sheetName}`);\r\n\r\n        const sheet = workbook.Sheets[sheetName];\r\n        const rawData = XLSX.utils.sheet_to_json(sheet);\r\n        logs.push(`Filas encontradas: ${rawData.length}`);\r\n\r\n        if (rawData.length > 0) {\r\n            logs.push(`Columnas detectadas: ${Object.keys(rawData[0] as any).join(' | ')}`);\r\n        }\r\n\r\n        // Fetch ACTIVO + REVISAR players\r\n        const dbPlayers = await (prisma.player as any).findMany({\r\n            where: { status: { in: ['ACTIVO', 'REVISAR'] } },\r\n            select: { id: true, firstName: true, lastName: true, dni: true, partnerNumber: true, tira: true, category: true }\r\n        });\r\n        logs.push(`Jugadores (ACTIVO + REVISAR) en DB: ${dbPlayers.length}`);\r\n\r\n        const results: PlayerMatchResult[] = [];\r\n        let matchedCount = 0;\r\n\r\n        for (const [index, row] of rawData.entries()) {\r\n            const r = row as any;\r\n            const rowNum = index + 2;\r\n            const notes: string[] = [];\r\n\r\n            // Flexible column detection - handles: documento, DNI\r\n            const dniKey = findColumn(r, ['documento', 'dni']);\r\n            // nrosocio (sin espacio), nro. socio, nro socio\r\n            const socioKey = findColumn(r, ['nrosocio', 'nro. socio', 'nro socio', 'socio']);\r\n            const apellidoKey = findColumn(r, ['apellido']);\r\n            const nombreKey = findColumn(r, ['nombre']);\r\n            // \"Ultima cuota social abonada\" / \"Ultoma cuota Social Abonada\"\r\n            const socialKey = findColumn(r, ['ultima cuota social abonada', 'ultima cuota social', 'cuota social']);\r\n            const activityKey = findColumn(r, ['ultima cuota actividad abonada', 'ultima cuota actividad', 'cuota actividad']);\r\n\r\n            const dni = dniKey ? r[dniKey]?.toString().trim() : undefined;\r\n            const socio = socioKey ? r[socioKey]?.toString().trim() : undefined;\r\n            const apellido = apellidoKey ? normalizeString(r[apellidoKey]?.toString()) : '';\r\n            const nombre = nombreKey ? normalizeString(r[nombreKey]?.toString()) : '';\r\n            const lastSocial = socialKey ? r[socialKey]?.toString().trim() : undefined;\r\n            const lastActivity = activityKey ? r[activityKey]?.toString().trim() : undefined;\r\n\r\n            let match: typeof dbPlayers[0] | undefined;\r\n            let method: 'DNI' | 'PARTNER_NUMBER' | 'NAME_FUZZY' | undefined;\r\n\r\n            // 1. Try DNI / Documento\r\n            if (dni && dni.length > 4) {\r\n                match = dbPlayers.find((p: any) => p.dni === dni);\r\n                if (match) method = 'DNI';\r\n            }\r\n\r\n            // 2. Try Nro. Socio\r\n            if (!match && socio) {\r\n                match = dbPlayers.find((p: any) => p.partnerNumber === socio);\r\n                if (match) method = 'PARTNER_NUMBER';\r\n            }\r\n\r\n            // 3. Try Name Fuzzy (exact clean match)\r\n            if (!match && nombre && apellido) {\r\n                match = dbPlayers.find((p: any) =>\r\n                    normalizeString(p.firstName) === nombre &&\r\n                    normalizeString(p.lastName) === apellido\r\n                );\r\n                if (match) method = 'NAME_FUZZY';\r\n            }\r\n\r\n            const paymentStatus: PaymentStatus = {\r\n                social: lastSocial || '-',\r\n                activity: lastActivity || '-',\r\n                socialDate: lastSocial,\r\n                activityDate: lastActivity\r\n            };\r\n\r\n            if (match) {\r\n                matchedCount++;\r\n                logs.push(`Fila ${rowNum}: Encontrado ${match.firstName} ${match.lastName} por ${method}`);\r\n                results.push({\r\n                    status: 'MATCHED',\r\n                    matchMethod: method,\r\n                    originalData: row,\r\n                    player: {\r\n                        id: match.id,\r\n                        name: `${match.lastName}, ${match.firstName}`,\r\n                        dni: match.dni,\r\n                        category: match.category || 'N/A',\r\n                        tira: match.tira\r\n                    },\r\n                    paymentStatus,\r\n                    notes\r\n                });\r\n            } else {\r\n                notes.push(`No se pudo encontrar jugador: ${apellido}, ${nombre} (DNI: ${dni})`);\r\n                results.push({\r\n                    status: 'UNMATCHED',\r\n                    originalData: row,\r\n                    paymentStatus,\r\n                    notes\r\n                });\r\n            }\r\n        }\r\n\r\n        logs.push(`Proceso de ANÁLISIS finalizado. Coincidencias: ${matchedCount}/${rawData.length}`);\r\n        logs.push(`NOTA: No se han guardado cambios en la base de datos. Revise y confirme.`);\r\n\r\n        return {\r\n            success: true,\r\n            stats: { total: rawData.length, matched: matchedCount, unmatched: rawData.length - matchedCount },\r\n            results,\r\n            logs\r\n        };\r\n\r\n    } catch (e: any) {\r\n        logs.push(`ERROR CRÍTICO: ${e.message}`);\r\n        return { success: false, message: e.message, stats: { total: 0, matched: 0, unmatched: 0 }, results: [], logs };\r\n    }\r\n}\r\n\r\nexport async function savePaymentUpdates(prevState: any, dataset: PlayerMatchResult[]) {\r\n    const session = await auth();\r\n    if (!session) return { success: false, message: \"No autorizado\" };\r\n\r\n    const updates = dataset.filter(d => d.status === 'MATCHED' && d.player?.id);\r\n    let count = 0;\r\n\r\n    try {\r\n        for (const item of updates) {\r\n            if (!item.player?.id) continue;\r\n            await (prisma.player as any).update({\r\n                where: { id: item.player.id },\r\n                data: {\r\n                    lastSocialPayment: item.paymentStatus?.social,\r\n                    lastActivityPayment: item.paymentStatus?.activity\r\n                }\r\n            });\r\n            count++;\r\n        }\r\n        await createAuditLog('IMPORT_PAYMENTS', 'Player', 'BATCH', { count, total: updates.length });\r\n        return { success: true, message: `Se actualizaron los pagos de ${count} jugadores correctamente.` };\r\n    } catch (error: any) {\r\n        return { success: false, message: \"Error al guardar: \" + error.message };\r\n    }\r\n}\r\n\r\n// ─── SEGURO / FEDERACIÓN ─────────────────────────────────────────────────────\r\n\r\nexport async function processFederationPaymentExcel(prevState: any, formData: FormData): Promise<FederationImportResult> {\r\n    const session = await auth();\r\n    if (!session) {\r\n        return { success: false, message: \"No autorizado\", stats: { total: 0, matched: 0, unmatched: 0 }, results: [], logs: [\"Error: Usuario no autenticado\"] };\r\n    }\r\n\r\n    const file = formData.get('file') as File;\r\n    if (!file) {\r\n        return { success: false, message: \"No se seleccionó archivo\", stats: { total: 0, matched: 0, unmatched: 0 }, results: [], logs: [\"Error: Sin archivo\"] };\r\n    }\r\n\r\n    const logs: string[] = [];\r\n    logs.push(`Inicio de procesamiento: ${new Date().toLocaleString()}`);\r\n\r\n    try {\r\n        const arrayBuffer = await file.arrayBuffer();\r\n        const buffer = Buffer.from(arrayBuffer);\r\n        const workbook = XLSX.read(buffer, { type: 'buffer' });\r\n\r\n        const sheetName = workbook.SheetNames[0];\r\n        logs.push(`Leyendo hoja: ${sheetName}`);\r\n\r\n        const sheet = workbook.Sheets[sheetName];\r\n        const rawData = XLSX.utils.sheet_to_json(sheet);\r\n        logs.push(`Filas encontradas: ${rawData.length}`);\r\n\r\n        if (rawData.length > 0) {\r\n            logs.push(`Columnas detectadas: ${Object.keys(rawData[0] as any).join(' | ')}`);\r\n        }\r\n\r\n        // Fetch ACTIVO + REVISAR players\r\n        const dbPlayers = await (prisma.player as any).findMany({\r\n            where: { status: { in: ['ACTIVO', 'REVISAR'] } },\r\n            select: { id: true, firstName: true, lastName: true, dni: true, tira: true, category: true, status: true }\r\n        });\r\n        logs.push(`Jugadores (ACTIVO + REVISAR) en DB: ${dbPlayers.length}`);\r\n\r\n        const results: FederationMatchResult[] = [];\r\n        let matchedCount = 0;\r\n\r\n        for (const [index, row] of rawData.entries()) {\r\n            const r = row as any;\r\n            const rowNum = index + 2;\r\n            const notes: string[] = [];\r\n\r\n            const dniKey = findColumn(r, ['dni', 'documento']);\r\n            const apellidoKey = findColumn(r, ['apellido']);\r\n            const nombreKey = findColumn(r, ['nombre']);\r\n            const yearKey = findColumn(r, ['año', 'anio', 'year', 'año pago', 'año del pago']);\r\n            const cuotasKey = findColumn(r, ['cuotas', 'cuotas abonadas', 'cuotas pagadas', 'installments', 'estado']);\r\n\r\n            const dni = dniKey ? r[dniKey]?.toString().trim() : undefined;\r\n            const apellido = apellidoKey ? normalizeString(r[apellidoKey]?.toString()) : '';\r\n            const nombre = nombreKey ? normalizeString(r[nombreKey]?.toString()) : '';\r\n            const yearRaw = yearKey ? r[yearKey]?.toString().trim() : undefined;\r\n            const cuotasRaw = cuotasKey ? r[cuotasKey]?.toString().trim().toUpperCase() : undefined;\r\n\r\n            const year = yearRaw ? parseInt(yearRaw) : NaN;\r\n            const installments = cuotasRaw || '';\r\n\r\n            let match: typeof dbPlayers[0] | undefined;\r\n            let method: 'DNI' | 'NAME_FUZZY' | undefined;\r\n\r\n            if (dni && dni.length > 4) {\r\n                match = dbPlayers.find((p: any) => p.dni === dni);\r\n                if (match) method = 'DNI';\r\n            }\r\n\r\n            if (!match && nombre && apellido) {\r\n                match = dbPlayers.find((p: any) =>\r\n                    normalizeString(p.firstName) === nombre &&\r\n                    normalizeString(p.lastName) === apellido\r\n                );\r\n                if (match) method = 'NAME_FUZZY';\r\n            }\r\n\r\n            const federationData: FederationPaymentData | undefined =\r\n                (!isNaN(year) && installments) ? { year, installments } : undefined;\r\n\r\n            if (!federationData) {\r\n                notes.push(`Fila ${rowNum}: Año o cuotas inválidos o faltantes.`);\r\n            }\r\n\r\n            if (match) {\r\n                matchedCount++;\r\n                logs.push(`Fila ${rowNum}: Encontrado ${match.firstName} ${match.lastName} (${match.status}) por ${method}`);\r\n                results.push({\r\n                    status: 'MATCHED',\r\n                    matchMethod: method,\r\n                    originalData: row,\r\n                    player: {\r\n                        id: match.id,\r\n                        name: `${match.lastName}, ${match.firstName}`,\r\n                        dni: match.dni,\r\n                        category: match.category || 'N/A',\r\n                        tira: match.tira,\r\n                        playerStatus: match.status\r\n                    },\r\n                    federationData,\r\n                    notes\r\n                });\r\n            } else {\r\n                notes.push(`No se pudo encontrar jugador: ${apellido}, ${nombre} (DNI: ${dni})`);\r\n                results.push({ status: 'UNMATCHED', originalData: row, federationData, notes });\r\n            }\r\n        }\r\n\r\n        logs.push(`Proceso de ANÁLISIS finalizado. Coincidencias: ${matchedCount}/${rawData.length}`);\r\n        logs.push(`NOTA: No se han guardado cambios en la base de datos. Revise y confirme.`);\r\n\r\n        return {\r\n            success: true,\r\n            stats: { total: rawData.length, matched: matchedCount, unmatched: rawData.length - matchedCount },\r\n            results,\r\n            logs\r\n        };\r\n\r\n    } catch (e: any) {\r\n        logs.push(`ERROR CRÍTICO: ${e.message}`);\r\n        return { success: false, message: e.message, stats: { total: 0, matched: 0, unmatched: 0 }, results: [], logs };\r\n    }\r\n}\r\n\r\nexport async function saveFederationPaymentUpdates(prevState: any, dataset: FederationMatchResult[]) {\r\n    const session = await auth();\r\n    if (!session) return { success: false, message: \"No autorizado\" };\r\n\r\n    const updates = dataset.filter(d => d.status === 'MATCHED' && d.player?.id && d.federationData);\r\n    let count = 0;\r\n\r\n    try {\r\n        for (const item of updates) {\r\n            if (!item.player?.id || !item.federationData) continue;\r\n            await (prisma.player as any).update({\r\n                where: { id: item.player.id },\r\n                data: {\r\n                    federationYear: item.federationData.year,\r\n                    federationInstallments: item.federationData.installments\r\n                }\r\n            });\r\n            count++;\r\n        }\r\n        await createAuditLog('IMPORT_FEDERATION_PAYMENTS', 'Player', 'BATCH', { count, total: updates.length });\r\n        return { success: true, message: `Se actualizó el pago de federación/seguro de ${count} jugadores correctamente.` };\r\n    } catch (error: any) {\r\n        return { success: false, message: \"Error al guardar: \" + error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1171, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/damia/My%20Drive/Consultorias/All%20Boys/gestion-basket-app/.next-internal/server/app/dashboard/payments/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getAllRolePermissions as '00389c4dee762c9752fa78abeb9062f32a2bc77388'} from 'ACTIONS_MODULE0'\nexport {getPermissionsForRole as '405b1fff19e2829eba6c9bf3e477254b7973b8a323'} from 'ACTIONS_MODULE0'\nexport {hasPermission as '6028f758cf28d192fd5c86810b2b38b40bb85b5b68'} from 'ACTIONS_MODULE0'\nexport {updateRolePermission as '70b175dc5144eb864d129ad1d180d711c56c75c19e'} from 'ACTIONS_MODULE0'\nexport {handleSignOut as '00172bdecf9bdacb64dd4c5180e9c8675d7b15d573'} from 'ACTIONS_MODULE1'\nexport {processPaymentExcel as '6037dc25af853f7cf241394b6d02360816cbcd415e'} from 'ACTIONS_MODULE2'\nexport {savePaymentUpdates as '6039d2df14dbe3d599392e781b006af8ae4dcd3002'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AAIA;AACA"}}]
}